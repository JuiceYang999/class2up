

## ğŸ¯ ç›®æ ‡

æ‚¨çš„æ ¸å¿ƒä»»åŠ¡æ˜¯å¼€å‘ä¸€ä¸ªâ€œå¤§æ•°æ®é‡‡é›†ã€å­˜å‚¨ä¸åˆ†æç³»ç»Ÿâ€ã€‚æ ¹æ®ã€Šå¤§æ•°æ®éƒ¨åˆ†é¡¹ç›®æŒ‡å¯¼ä¹¦ã€‹å’Œã€Šå®éªŒæ­¥éª¤.pdfã€‹ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹7ä¸ªä¸»è¦ä»»åŠ¡é€æ­¥æ¨è¿›ï¼š

#### 1. æ­å»ºç³»ç»Ÿæ¡†æ¶ (VUE)

* **ä»»åŠ¡ï¼š** åŸºäºVUEè®¾è®¡å¹¶æ­å»ºå¤§æ•°æ®é‡‡é›†ä¸åˆ†æç³»ç»Ÿæ¡†æ¶ã€‚
* **æ­¥éª¤ï¼š**
  1.  **åˆ›å»ºé¡¹ç›®ï¼š** ä½¿ç”¨ `vue ui` å‘½ä»¤åˆ›å»ºæ–°çš„VUEé¡¹ç›®ã€‚
  2.  **æ–‡ä»¶ç»“æ„ï¼š** åœ¨ `components` æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º `CoreSource.vue` (æ•°æ®é‡‡é›†ç•Œé¢)ã€`ShowData.vue` (æ•°æ®æ˜¾ç¤ºç•Œé¢)ã€`DataProcess.vue` (æ•°æ®åˆ†æç•Œé¢) ç­‰æ ¸å¿ƒæ–‡ä»¶ã€‚åŒæ—¶ï¼Œæ–°å»º `pyt` æ–‡ä»¶å¤¹åŠ `backend.py` æ–‡ä»¶ç”¨äºåç«¯å¼€å‘ã€‚
  3.  **ç•Œé¢å…ƒç´ ï¼š** åœ¨ `main.js` ä¸­å¯¼å…¥ Element UI åº“ã€‚ç„¶ååœ¨ `.vue` æ–‡ä»¶çš„ `<template>` éƒ¨åˆ†ä½¿ç”¨ `<el-button>`ã€`<el-card>` ç­‰ç»„ä»¶æ­å»ºç”¨æˆ·ç•Œé¢ã€‚
  4.  **é¡µé¢è·¯ç”±ï¼š** åœ¨ `main.js` ä¸­å¼•å…¥å¹¶é…ç½® `VueRouter`ã€‚åœ¨ `App.vue` ä¸­ä½¿ç”¨ `<router-view>` æ¥æ˜¾ç¤ºä¸åŒé¡µé¢ï¼Œå¹¶é€šè¿‡ `<el-button>` çš„ç‚¹å‡»äº‹ä»¶ (`@click="onSubmit"`) é…åˆ `this.$router.push` å®ç°é¡µé¢è·³è½¬ã€‚

#### 2. è¿è¡Œè™šæ‹Ÿæ•°æ®æº (MQTT)

* **ä»»åŠ¡ï¼š** å»ºç«‹ä¸è¾¹ç¼˜è®¾å¤‡ï¼ˆè™šæ‹Ÿï¼‰çš„é€šä¿¡ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨è™šæ‹Ÿæ•°æ§ç³»ç»Ÿä½œä¸ºæ•°æ®æºã€‚
* **æ­¥éª¤ï¼š**
  1.  **å¯åŠ¨MQTTæœåŠ¡å™¨ï¼š** åœ¨ `emqx-5.0.11-windows-amd64\bin` è·¯å¾„ä¸‹ï¼Œé€šè¿‡ `cmd` è¿è¡Œ `emqx start` å‘½ä»¤ã€‚
  2.  **å¯åŠ¨è™šæ‹Ÿæ•°æ§æœåŠ¡ï¼š** åœ¨ `StressTest-INC-Cloud` è·¯å¾„ä¸‹ï¼Œé€šè¿‡ `cmd` è¿è¡Œ `StressTest-INC-Cloud -n 1 -b 0` å‘½ä»¤ã€‚è¿™å°†æ¨¡æ‹Ÿä¸€ä¸ªåºå·ä¸º0çš„æ•°æ§ç³»ç»Ÿã€‚
  3.  **(å¯é€‰) æµ‹è¯•è¿æ¥ï¼š** ä½¿ç”¨ MQTTX è½¯ä»¶è¿æ¥åˆ° `127.0.0.1:1883`ï¼Œé€šè¿‡å‘å¸ƒå’Œè®¢é˜…æŒ‡ä»¤ï¼ˆå¦‚ `Probe/Query/Request/STRESS_TEST_00000`ï¼‰æ¥æµ‹è¯•è™šæ‹ŸæœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

#### 3. å®ç°å‰åç«¯é€šä¿¡ä¸æ•°æ®è·å–

* **ä»»åŠ¡ï¼š** åˆ©ç”¨Pythonåç«¯è¿æ¥MQTTæœåŠ¡å™¨å¹¶è·å–æ•°æ®ï¼Œå®ç°å‰åç«¯é€šä¿¡ã€‚
* **æ­¥éª¤ï¼š**
  1.  **åç«¯ (Python + Flask)ï¼š**
      * ä½¿ç”¨ `flask` æ¡†æ¶æ­å»ºåç«¯æœåŠ¡ã€‚
      * ä½¿ç”¨ `@app.route('/connect/', ...)` å®šä¹‰æ¥å£ï¼Œé€šè¿‡ `request.get_json()['data']` æ¥æ”¶å‰ç«¯å‘é€çš„æ•°æ®ã€‚
      * ä½¿ç”¨ `flask_mqtt` åº“æ ¹æ®å‰ç«¯ä¼ é€’çš„é…ç½®ï¼ˆå¦‚æœåŠ¡å™¨åœ°å€ã€ä¸»é¢˜ï¼‰æ¥è¿æ¥MQTTæœåŠ¡å™¨ã€è®¢é˜…(Subscribe)å’Œå‘å¸ƒ(Publish)æ¶ˆæ¯ï¼Œä»¥è·å–å®æ—¶æ•°æ®ã€‚
  2.  **å‰ç«¯ (VUE + Axios)ï¼š**
      * åœ¨ `vue.config.js` ä¸­é…ç½® `devServer proxy` ä»¥è§£å†³è·¨åŸŸé—®é¢˜ã€‚
      * å¯¼å…¥ `axios` åº“ï¼Œä½¿ç”¨ `axios.post('/connect/', {data:this.connection})` å°†æ•°æ®é‡‡é›†ç•Œé¢çš„é…ç½®ä¿¡æ¯å‘é€ç»™åç«¯ã€‚
      * é€šè¿‡ `.then(res => { ... })` æ¥æ”¶åç«¯è¿”å›çš„å“åº”ã€‚

#### 4. å®ç°æ•°æ®å¯è§†åŒ– (Echarts)

* **ä»»åŠ¡ï¼š** è®¾è®¡Webç½‘é¡µï¼Œå®ç°æ•°æ®çš„å®æ—¶å¯è§†åŒ–ã€‚
* **æ­¥éª¤ï¼š**
  1.  **å¼•å…¥åº“ï¼š** åœ¨ `main.js` ä¸­å¯¼å…¥ `echarts`ã€‚
  2.  **å®šä¹‰å›¾è¡¨å®¹å™¨ï¼š** åœ¨ `ShowData.vue` çš„ `<template>` ä¸­ï¼Œæ”¾ç½®ä¸€ä¸ª `div` å¹¶è®¾ç½® `id` (ä¾‹å¦‚ `<div id='x.actualspeed' ...>`)ã€‚
  3.  **åˆå§‹åŒ–å›¾è¡¨ï¼š** åœ¨ `<script>` ä¸­ï¼Œé€šè¿‡ `echarts.init(document.getElementById('x.actualspeed'))` åˆå§‹åŒ–å›¾è¡¨ã€‚
  4.  **æ›´æ–°æ•°æ®ï¼š** åç«¯ç¨‹åºè§£æMQTTè·å–çš„JSONæ•°æ®å¹¶å‘é€è‡³å‰ç«¯ã€‚å‰ç«¯åœ¨ `axios` çš„å›è°ƒä¸­è·å–æ•°æ®ï¼Œå¹¶ä½¿ç”¨ `this.chart.setOption({ series: [{ data: received_data }] })` æ¥åŠ¨æ€æ›´æ–°å›¾è¡¨ã€‚

#### 5. å®ç°æ•°æ®å­˜å‚¨ (InfluxDB & MySQL)

* **ä»»åŠ¡ï¼š** åŸºäºInfluxDBå’ŒMySQLæ•°æ®åº“å®ç°æ•°æ®å­˜å‚¨ã€‚
* **æ­¥éª¤ï¼š**
  1.  **InfluxDB (æ—¶åºæ•°æ®)ï¼š**
      * **æœ¬åœ°ï¼š** è¿è¡Œ `influxd` å¯åŠ¨æœ¬åœ°æœåŠ¡ã€‚è®¿é—® `http://localhost:8086`ï¼Œæ³¨å†Œå¹¶åˆ›å»º `bucket` (æ•°æ®æ¡¶)ã€‚
      * **äº‘ç«¯ï¼š** è®¿é—®äº‘ç«¯InfluxDBç½‘å€ï¼Œæ³¨å†Œç™»å½•ï¼Œå¹¶åŒæ ·åˆ›å»º `bucket`ã€‚
      * **å®ç°ï¼š** åœ¨åç«¯Pythonæˆ–å‰ç«¯Node.jsä¸­ï¼Œä½¿ç”¨InfluxDBçš„API tokenå’Œé…ç½®ä¿¡æ¯ï¼Œå°†é‡‡é›†åˆ°çš„æ•°æ®å†™å…¥æœ¬åœ°å’Œäº‘ç«¯çš„ `bucket` ä¸­ã€‚
  2.  **MySQL (å…³ç³»æ•°æ®)ï¼š**
      * **é…ç½®ï¼š** ç¡®ä¿MySQLæœåŠ¡å·²å®‰è£…å¹¶è¿è¡Œã€‚ä½¿ç”¨ Navicat Premium ç­‰å·¥å…·ï¼Œè¿æ¥åˆ° `localhost` (ç”¨æˆ·å `root`ï¼Œè¾“å…¥æ‚¨çš„å¯†ç )ã€‚
      * **åˆ›å»ºï¼š** æ–°å»ºæ•°æ®åº“ (å¦‚ `mqtt_data`)ï¼Œå¹¶åˆ›å»ºè¡¨ç»“æ„ã€‚
      * **å®ç°ï¼š** åœ¨åç«¯Pythonç¨‹åºä¸­ï¼Œä½¿ç”¨ `pymysql` åº“ã€‚è¿æ¥æ•°æ®åº“ (`pymysql.connect(...)`)ï¼Œåˆ›å»ºæ¸¸æ ‡ (`conn.cursor()`)ï¼Œæ‰§è¡Œ `insert` è¯­å¥ (`cur.execute(sql)`)ï¼Œå¹¶æäº¤äº‹åŠ¡ (`conn.commit()`)ã€‚

#### 6. å®ç°å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨

* **ä»»åŠ¡ï¼š** åŸºäºå·¥ä¸šå¤§æ•°æ®å¹³å°å®ç°å®æ—¶è·å–æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ã€‚
* **æ­¥éª¤ï¼š**
  * è¯¥ä»»åŠ¡è¦æ±‚å°†æ‚¨å­˜å…¥ MySQL çš„æ•°æ®ï¼Œä¸å·¥ä¸šå¤§æ•°æ®å¹³å°ï¼ˆåŸºäºHadoop HDFSï¼‰å»ºç«‹è¿æ¥ã€‚
  * æ‚¨éœ€è¦å¼€å‘æ•°æ®é€šä¿¡æ¥å£ï¼Œå°† MySQL æ•°æ®åº“ä¸­çš„æ•°æ®å†™å…¥å¤§æ•°æ®å¹³å°ï¼Œå®ç°åˆ†å¸ƒå¼å­˜å‚¨ã€‚

#### 7. å®ç°æ•°æ®åˆ†æä¸ç»“æœé›†æˆ

* **ä»»åŠ¡ï¼š** åˆ©ç”¨ç®—æ³•åˆ†ææ•°æ®ï¼Œå¹¶å°†åˆ†æç»“æœé›†æˆåˆ°ç³»ç»Ÿä¸­ã€‚
* **æ­¥éª¤ï¼š**
  1.  **è®­ç»ƒæ¨¡å‹ï¼š** æ ¹æ®æä¾›çš„æ•°æ®é›†ï¼Œä½¿ç”¨æœºå™¨å­¦ä¹ æˆ–æ·±åº¦å­¦ä¹ ç®—æ³•è®­ç»ƒä¸€ä¸ªè®¾å¤‡çŠ¶æ€é¢„æµ‹æ¨¡å‹ã€‚
  2.  **é›†æˆæ¨¡å‹ï¼š** å°†è®­ç»ƒå¥½çš„æ¨¡å‹é›†æˆåˆ° `backend.py` åç«¯ç¨‹åºä¸­ã€‚
  3.  **ç•Œé¢å±•ç¤ºï¼š** åœ¨ `DataProcess.vue` ç•Œé¢ ä¸­ï¼Œè®¾è®¡ç•Œé¢å…ƒç´ ï¼Œå…è®¸ç”¨æˆ·è§¦å‘åˆ†æã€‚åç«¯è°ƒç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼Œå¹¶å°†åˆ†æç»“æœï¼ˆå¦‚è®¾å¤‡çŠ¶æ€ï¼‰è¿”å›ç»™å‰ç«¯ï¼Œåœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºã€‚
---
## ç›¸å…³å¯åŠ¨æ“ä½œ
1.  **cmdå¯åŠ¨ï¼š**emqx start
StressTest-INC-Cloud -n 1 -b 0
influx

2.  **pythonç›´æ¥è¿è¡Œï¼š**backend.py

3.  **ç»ˆç«¯ç›´æ¥è¿è¡Œï¼š**yarn serve
vue uiï¼šåˆ›å»ºvueç•Œé¢çš„åŸºç¡€ä»£ç 

mysqlå¯†ç ï¼šcps@CPS123
æœ¬åœ°inflexdbTOKENï¼š7ucc4S8rrzwu85NA5nUYb_CNG7C-03Rbuyf2A85A5leATuxcPH_UlFvrCNXSGQtxvZQTuY_C6O7BUWNg4oIH-g==
äº‘ç«¯inflexdbTOKENï¼šexport zsOj7fEHWcI3DUOhFvhZ0iR39tRyWxko0oGAS5grC8PVyr-RhLe9X3WwHWPjdMJmiZRHwxqt2pE5XWi3TQ34Og==

vscodeè¿è¡Œï¼š
æ³¨æ„å¯¹åº”çš„ç¯å¢ƒåœ¨ç»ˆç«¯ä¸­æ‰“å¼€

githubé…ç½®ï¼š

>> git config --global --unset https.proxy
>> git config --global http.proxy http://127.0.0.1:7890                            
>> git config --global https.proxy http://127.0.0.1:7890                            

---

## ä»»åŠ¡ä¸€ï¼šæ­å»ºç³»ç»Ÿæ¡†æ¶ (VUE)

å°†å…¶ä»ä¸€ä¸ªåŸºç¡€æ¨¡æ¿ä¿®æ”¹ä¸ºç¬¦åˆæˆ‘ä»¬å®éªŒè¦æ±‚çš„â€œå¤§æ•°æ®é‡‡é›†ä¸åˆ†æç³»ç»Ÿâ€æ¡†æ¶ã€‚

æ‚¨å½“å‰çš„æ–‡ä»¶æ˜¯ä½¿ç”¨`vue-cli`åˆ›å»ºçš„ä¸€ä¸ªæ ‡å‡†Vue 2é¡¹ç›®ã€‚

### 1\. â€œè§£è¯»â€â€”â€”åˆ†æç°æœ‰ä»£ç 

  * `package.json`: å®šä¹‰äº†é¡¹ç›®ä¾èµ–ï¼Œæ ¸å¿ƒæ˜¯`vue: "^2.6.14"`ã€‚
  * `src/main.js`: é¡¹ç›®çš„å…¥å£æ–‡ä»¶ã€‚å®ƒç›®å‰åªåŠ è½½äº†`App.vue`ç»„ä»¶ã€‚
  * `src/App.vue`: é¡¹ç›®çš„æ ¹ç»„ä»¶ã€‚å®ƒç›®å‰æ˜¾ç¤ºä¸€ä¸ªLogoå’Œ`HelloWorld`ç»„ä»¶ã€‚
  * `src/components/HelloWorld.vue`: é»˜è®¤çš„æ¬¢è¿é¡µé¢ã€‚
  * `vue.config.js`: Vue CLIçš„é…ç½®æ–‡ä»¶ï¼Œç›®å‰æ˜¯ç©ºçš„ã€‚

### 2\. â€œè°ƒè¯•â€â€”â€”ä¿®æ”¹ä»£ç ä»¥æ­å»ºæ¡†æ¶

â€œè°ƒè¯•â€åœ¨è¿™é‡Œæ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¿®æ”¹å’Œæ·»åŠ ä»£ç ï¼Œä»¥æ»¡è¶³ã€Šå®éªŒæ­¥éª¤.pdfã€‹å’Œã€Šå¤§æ•°æ®éƒ¨åˆ†é¡¹ç›®æŒ‡å¯¼ä¹¦.pdfã€‹ä¸­çš„è¦æ±‚ã€‚

#### 2.1: å®‰è£…æ ¸å¿ƒä¾èµ–

æ ¹æ®å®éªŒæŒ‡å¯¼ä¹¦ï¼Œæˆ‘ä»¬éœ€è¦**é¡µé¢åˆ‡æ¢** (`vue-router`)ã€**UIç•Œé¢** (`element-ui`) å’Œ**å‰åç«¯é€šä¿¡** (`axios`)ã€‚

è¯·åœ¨æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•ï¼ˆ`juiceyang999/class2up/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc/`ï¼‰æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
yarn add vue-router@3 element-ui axios
```

*(æ³¨æ„ï¼šå› ä¸ºæ‚¨ä½¿ç”¨çš„æ˜¯Vue 2ï¼Œæ‰€ä»¥æˆ‘ä»¬å®‰è£… `vue-router@3`)*

#### 2.2: åˆ›å»ºé¡µé¢ç»„ä»¶

åœ¨ `src/components/` æ–‡ä»¶å¤¹ä¸­ï¼Œé™¤äº† `HelloWorld.vue`ï¼Œè¯·**æ–°å»º**ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼š

  * `CoreSource.vue` (æ•°æ®é‡‡é›†ç•Œé¢)
  * `ShowData.vue` (æ•°æ®æ˜¾ç¤ºç•Œé¢)
  * `DataProcess.vue` (æ•°æ®åˆ†æç•Œé¢)

ä¸ºäº†è®©å®ƒä»¬èƒ½æ˜¾ç¤ºå†…å®¹ï¼Œæ‚¨å¯ä»¥æš‚æ—¶åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­å¡«å…¥ä»¥ä¸‹åŸºç¡€ä»£ç ï¼ˆä»¥`CoreSource.vue`ä¸ºä¾‹ï¼‰ï¼š

```vue
<template>
  <div class="page">
    <h1>æ•°æ®é‡‡é›†ç•Œé¢</h1>
    </div>
</template>

<script>
export default {
  name: 'CoreSource'
}
</script>
```

#### 2.3: é…ç½®è·¯ç”± (src/router.js)

ã€Šå®éªŒæ­¥éª¤.pdfã€‹ä¸­æåˆ°äº† `vue router`ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–‡ä»¶æ¥ç®¡ç†é¡µé¢ä¹‹é—´çš„è·³è½¬ã€‚

åœ¨ `src/` ç›®å½•ä¸‹**æ–°å»º**ä¸€ä¸ªæ–‡ä»¶ `router.js`ï¼Œå¹¶å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š

```javascript
import Vue from 'vue'
import VueRouter from 'vue-router'

// å¼•å…¥æˆ‘ä»¬çš„ç»„ä»¶
import HelloWorld from './components/HelloWorld.vue'
import CoreSource from './components/CoreSource.vue'
import ShowData from './components/ShowData.vue'
import DataProcess from './components/DataProcess.vue'

Vue.use(VueRouter)

// å®šä¹‰è·¯ç”±è§„åˆ™
const routes = [
  {
    path: '/',
    name: 'Home',
    component: HelloWorld
  },
  {
    path: '/core',
    name: 'CoreSource',
    component: CoreSource
  },
  {
    path: '/show',
    name: 'ShowData',
    component: ShowData
  },
  {
    path: '/process',
    name: 'DataProcess',
    component: DataProcess
  }
]

// åˆ›å»º router å®ä¾‹
const router = new VueRouter({
  routes // (ç¼©å†™) ç›¸å½“äº routes: routes
})

export default router
```

#### 2.4: æŒ‚è½½è·¯ç”±å’ŒUIåº“ (ä¿®æ”¹ src/main.js)

[cite\_start]ç°åœ¨æˆ‘ä»¬éœ€è¦å‘Šè¯‰Vueâ€œä½¿ç”¨â€æˆ‘ä»¬åˆšåˆšå®‰è£…çš„ `ElementUI` [cite: 1091] å’Œ `router.js`ã€‚

è¯·**ä¿®æ”¹** `src/main.js` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```javascript
import Vue from 'vue'
import App from './App.vue'

// 1. å¼•å…¥ Element UI
import ElementUI from 'element-ui';
import 'element-ui/lib/theme-chalk/index.css';

// 2. å¼•å…¥è·¯ç”±
import router from './router'

Vue.config.productionTip = false

// 3. ä½¿ç”¨æ’ä»¶
Vue.use(ElementUI);

new Vue({
  // 4. æŒ‚è½½ router
  router,
  render: h => h(App),
}).$mount('#app')
```

#### 2.5: ä¿®æ”¹ä¸»å¸ƒå±€ (ä¿®æ”¹ src/App.vue)

æœ€åï¼Œæˆ‘ä»¬ä¿®æ”¹æ ¹ç»„ä»¶ `App.vue`ï¼Œå°†å®ƒä»æ˜¾ç¤º "HelloWorld" æ”¹ä¸ºæ˜¾ç¤º**å¯¼èˆªèœå•**å’Œ**è·¯ç”±é¡µé¢**ã€‚

è¯·**æ›¿æ¢** `src/App.vue` çš„å…¨éƒ¨å†…å®¹ä¸ºï¼š

```vue
<template>
  <div id="app">
    <el-menu :router="true" mode="horizontal" default-active="/">
      <el-menu-item index="/">æ¬¢è¿ç•Œé¢</el-menu-item>
      <el-menu-item index="/core">æ•°æ®é‡‡é›†</el-menu-item>
      <el-menu-item index="/show">æ•°æ®æ˜¾ç¤º</el-menu-item>
      <el-menu-item index="/process">æ•°æ®åˆ†æ</el-menu-item>
    </el-menu>

    <router-view></router-view>
  </div>
</template>

<script>
export default {
  name: 'App'
}
</script>

<style>
/* ä¿æŒåŸæœ‰æ ·å¼ï¼Œå¹¶ç§»é™¤é¡¶éƒ¨çš„60pxè¾¹è· */
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  /* margin-top: 60px; */ /* ç§»é™¤æˆ–æ³¨é‡Šæ‰æ­¤è¡Œ */
}
</style>
```

#### 2.6: é…ç½®è·¨åŸŸä»£ç† (ä¿®æ”¹ vue.config.js)

[cite\_start]ä¸ºäº†å‡†å¤‡åç»­çš„â€œå‰åç«¯é€šä¿¡â€ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸ªä»£ç†ï¼ˆproxyï¼‰æ¥è§£å†³è·¨åŸŸé—®é¢˜ï¼Œè¿™åœ¨ã€Šå®éªŒæ­¥éª¤.pdfã€‹ä¸­ä¹Ÿæœ‰æåŠ [cite: 1149, 1151]ã€‚

è¯·**ä¿®æ”¹** `vue.config.js` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```javascript
const { defineConfig } = require('@vue/cli-service')
module.exports = defineConfig({
  transpileDependencies: true,

  // æ·»åŠ  devServer é…ç½®
  devServer: {
    proxy: {
      // '/api' æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ ‡è¯†ï¼Œæ‰€æœ‰ä»¥ /api å¼€å¤´çš„è¯·æ±‚éƒ½ä¼šè¢«ä»£ç†
      '/api': {
        target: 'http://127.0.0.1:5000', // è¿™æ˜¯æˆ‘ä»¬åç«¯ Python Flask æœåŠ¡çš„åœ°å€
        changOrigin: true, // å…è®¸è·¨åŸŸ
        pathRewrite: {
          '^/api': '' // åœ¨è¯·æ±‚æ—¶ï¼Œå°† /api æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²
        }
      }
    }
  }
})
```

-----

### 3\. éªŒè¯æ¡†æ¶

å®Œæˆä»¥ä¸Šæ‰€æœ‰ä¿®æ”¹åï¼Œè¯·åœ¨ç»ˆç«¯è¿è¡Œï¼š

```bash
yarn serve
```

[cite\_start]ç°åœ¨è®¿é—®æµè§ˆå™¨ï¼ˆé€šå¸¸æ˜¯ `http://localhost:8080` æˆ– `http://localhost:8081` [cite: 901]ï¼‰ï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªåŒ…å«â€œæ¬¢è¿ç•Œé¢â€ã€â€œæ•°æ®é‡‡é›†â€ã€â€œæ•°æ®æ˜¾ç¤ºâ€ã€â€œæ•°æ®åˆ†æâ€çš„å¯¼èˆªæ ã€‚ç‚¹å‡»å®ƒä»¬ï¼Œä¸‹æ–¹çš„é¡µé¢å†…å®¹ä¼šéšä¹‹åˆ‡æ¢ã€‚

è¿™æ ‡å¿—ç€**ä»»åŠ¡1ï¼šæ­å»ºç³»ç»Ÿæ¡†æ¶**å·²æˆåŠŸå®Œæˆã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å¼€å§‹**ä»»åŠ¡2ï¼šè¿è¡Œè™šæ‹Ÿæ•°æ®æº (MQTT)**ã€‚è¯·ç¡®è®¤æ‚¨æ˜¯å¦å·²å‡†å¤‡å¥½ `emqx` å’Œ `StressTest-INC-Cloud` è½¯ä»¶ã€‚

---

## ä»»åŠ¡äºŒï¼šè¿è¡Œè™šæ‹Ÿæ•°æ®æº (MQTT)

è¿™ä¸ªä»»åŠ¡ä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œæ˜¯çº¯ç²¹çš„ç¯å¢ƒè¿è¡Œæ­¥éª¤ã€‚æ ¹æ®ã€Šå®éªŒæ­¥éª¤.pdfã€‹ï¼Œæ‚¨éœ€è¦å¯åŠ¨ä¸¤ä¸ªæœåŠ¡æ¥æ¨¡æ‹Ÿæ•°æ§æœºåºŠçš„æ•°æ®æºã€‚

å½“æ‚¨å›åˆ°ä¸»æœºåï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

#### 1\. å¯åŠ¨ EMQX (MQTT Broker/æœåŠ¡å™¨)

  * **ç›®çš„ï¼š** å¯åŠ¨MQTTæ¶ˆæ¯ä»£ç†æœåŠ¡å™¨ã€‚è¿™æ˜¯æ‰€æœ‰æ•°æ®å‘å¸ƒå’Œè®¢é˜…çš„ä¸­è½¬ç«™ã€‚

  * **æ­¥éª¤ï¼š**

    1. æ‰“å¼€ `cmd` (å‘½ä»¤æç¤ºç¬¦)ã€‚

    2. `cd` (åˆ‡æ¢ç›®å½•) åˆ°æ‚¨çš„ EMQX `bin` æ–‡ä»¶å¤¹ã€‚æ ¹æ®æ–‡æ¡£ï¼Œè·¯å¾„ç±»ä¼¼ï¼š`....../emqx-5.0.11-windows-amd64\bin`ã€‚

    3. è¾“å…¥å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

       ```bash
       emqx start
       ```

    4. **éªŒè¯ï¼š** å¯åŠ¨æˆåŠŸåï¼Œæ‚¨ä¼šçœ‹åˆ°ç›¸å…³çš„å¯åŠ¨ä¿¡æ¯ã€‚æ‚¨å¯ä»¥å…³é—­æ­¤ `cmd` çª—å£ï¼ŒæœåŠ¡å°†åœ¨åå°ç»§ç»­è¿è¡Œã€‚

#### 2\. å¯åŠ¨è™šæ‹Ÿæ•°æ§ç³»ç»Ÿ (MQTT Client/æ•°æ®å‘å¸ƒè€…)

  * **ç›®çš„ï¼š** å¯åŠ¨æ¨¡æ‹Ÿçš„æ•°æ§æœºåºŠæœåŠ¡ï¼Œå®ƒä¼šä½œä¸ºå®¢æˆ·ç«¯è¿æ¥åˆ° EMQXï¼Œå¹¶æŒç»­å‘å¸ƒï¼ˆPublishï¼‰æ¨¡æ‹Ÿçš„æœºåºŠæ•°æ®ã€‚

  * **æ­¥éª¤ï¼š**

    1. æ‰“å¼€ä¸€ä¸ªæ–°çš„ `cmd` (å‘½ä»¤æç¤ºç¬¦)ã€‚

    2. `cd` (åˆ‡æ¢ç›®å½•) åˆ°æ‚¨çš„ `StressTest-INC-Cloud` æ–‡ä»¶å¤¹ã€‚æ ¹æ®æ–‡æ¡£ï¼Œè·¯å¾„ç±»ä¼¼ï¼š`....../StressTest-INC-Cloud`ã€‚

    3. è¾“å…¥å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

       ```bash
       StressTest-INC-Cloud -n 1 -b 0
       ```

    4. **å‚æ•°è¯´æ˜ï¼š**

         * `-n 1`ï¼šè¡¨ç¤ºæ¨¡æ‹Ÿ1ä¸ªæ•°æ§ç³»ç»Ÿã€‚
         * `-b 0`ï¼šè¡¨ç¤ºåºå·ä»0å¼€å§‹ã€‚

    5. **éªŒè¯ï¼š** å¯åŠ¨æˆåŠŸåï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼ `STRESS_TEST_00000 is Connecting` å’Œ `STRESS_TEST_00000 Connected` çš„è¾“å‡ºã€‚**è¯·ä¿æŒæ­¤ `cmd` çª—å£æ‰“å¼€**ï¼Œå…³é—­å®ƒä¼šä¸­æ­¢æ•°æ®å‘é€ã€‚

####  3. ä½¿ç”¨ MQTTX æµ‹è¯•æ•°æ®æº

åœ¨è¿›è¡Œä¸‹ä¸€æ­¥ç¼–ç å‰ï¼Œæ‚¨å¯ä»¥ï¼ˆåœ¨ä¸»æœºä¸Šï¼‰ä½¿ç”¨ MQTTX è½¯ä»¶æ¥éªŒè¯æ•°æ®æ˜¯å¦åœ¨æ­£å¸¸å‘å¸ƒã€‚

1.  **å®‰è£…ï¼š** ç¡®ä¿æ‚¨å·²å®‰è£… MQTTXã€‚
2.  **è¿æ¥ï¼š** æ–°å»ºè¿æ¥ï¼ŒIPåœ°å€å¡« `127.0.0.1`ï¼Œç«¯å£å¡« `1883`ã€‚
3.  **è®¢é˜…ï¼š**
      * è®¢é˜…ä¸»é¢˜ï¼ˆTopicï¼‰ï¼š`Probe/Query/Response/STRESS_TEST_00000`ã€‚
      * ç‚¹å‡»â€œè®¢é˜…â€ã€‚
4.  **å‘å¸ƒï¼š**
      * åˆ‡æ¢åˆ°å‘å¸ƒï¼ˆPublishï¼‰åŒºåŸŸã€‚
      * å‘å¸ƒä¸»é¢˜ï¼ˆTopicï¼‰ï¼š`Probe/Query/Request/STRESS_TEST_00000`ã€‚
      * æŒ‡ä»¤å­—ï¼ˆPayloadï¼‰ç•™ç©ºï¼ˆå³å‘é€ `""`ï¼‰ã€‚
      * ç‚¹å‡»â€œå‘å¸ƒâ€ã€‚
5.  **éªŒè¯ï¼š** å›åˆ°è®¢é˜…é¡µé¢ï¼Œæ‚¨åº”è¯¥èƒ½æ”¶åˆ°ä¸€å¤§ä¸²JSONæ ¼å¼çš„æ•°æ®ï¼Œè¿™ä»£è¡¨è™šæ‹ŸæœåŠ¡å·¥ä½œæ­£å¸¸ã€‚

-----

ä»¥ä¸Šå°±æ˜¯ä»»åŠ¡äºŒçš„å…¨éƒ¨å†…å®¹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›è¡Œ**ä»»åŠ¡ä¸‰ï¼šå®ç°å‰åç«¯é€šä¿¡ä¸æ•°æ®è·å–**ã€‚è¿™åŒ…æ‹¬ä¿®æ”¹VUEç•Œé¢ä»¥å‘é€è¿æ¥è¯·æ±‚ï¼Œä»¥åŠç¼–å†™Pythonåç«¯æ¥æ¥æ”¶è¯·æ±‚å¹¶è¿æ¥MQTTã€‚

---

## **ä»»åŠ¡ä¸‰ï¼šå®ç°å‰åç«¯é€šä¿¡ä¸æ•°æ®è·å–**

æ­¤ä»»åŠ¡åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š

1.  **å‰ç«¯ (VUE)**ï¼šä¿®æ”¹ `CoreSource.vue` æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªè¡¨å•ï¼Œè®©ç”¨æˆ·èƒ½è¾“å…¥MQTTæœåŠ¡å™¨ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ `axios` å°†è¿™äº›ä¿¡æ¯å‘é€åˆ°åç«¯ã€‚
2.  **åç«¯ (Python)**ï¼šåˆ›å»º `pyt/backend.py` æ–‡ä»¶ï¼Œä½¿ç”¨ `Flask` æ¡†æ¶æ­å»ºä¸€ä¸ªWebæœåŠ¡ï¼Œè¯¥æœåŠ¡ä¼šæ¥æ”¶å‰ç«¯å‘æ¥çš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨ `flask-mqtt` åº“å°è¯•è¿æ¥åˆ°MQTTæœåŠ¡å™¨ã€‚

-----

### 3.1 å‰ç«¯ (VUE) ä»£ç ç¼–å†™

è¯·åœ¨ `src/components/` æ–‡ä»¶å¤¹ä¸­ï¼Œ**ä¿®æ”¹ `CoreSource.vue` æ–‡ä»¶**ã€‚
å°† `CoreSource.vue` çš„**å…¨éƒ¨å†…å®¹**æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ã€‚

**æ–‡ä»¶è·¯å¾„ï¼š** `juiceyang999/class2up/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc/src/components/CoreSource.vue`

```vue
<template>
  <el-container>
    <el-header>
      <h2>æ•°æ®é‡‡é›†ä¸æœåŠ¡å™¨è¿æ¥</h2>
    </el-header>
    <el-main>
      <el-row :gutter="20">
        <el-col :span="12">
          <el-card class="box-card">
            <div slot="header" class="clearfix">
              <span>MQTT æœåŠ¡å™¨è¿æ¥é…ç½®</span>
            </div>
            <el-form ref="form" :model="connection" label-width="120px">
              <el-form-item label="æœåŠ¡å™¨åœ°å€">
                <el-input v-model="connection.host"></el-input>
              </el-form-item>
              <el-form-item label="ç«¯å£å·">
                <el-input v-model.number="connection.port" type="number"></el-input>
              </el-form-item>
              <el-form-item label="Client ID">
                <el-input v-model="connection.clientid"></el-input>
              </el-form-item>
              <el-form-item>
                <el-button type="primary" @click="onConnect">è¿æ¥</el-button>
                <el-button @click="onDisconnect">æ–­å¼€</el-button>
              </el-form-item>
              <el-form-item label="è¿æ¥çŠ¶æ€">
                <el-tag :type="connectStatus ? 'success' : 'danger'">
                  {{ connectStatus ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}
                </el-tag>
              </el-form-item>
            </el-form>
          </el-card>
        </el-col>
        
        <el-col :span="12">
          <el-card class="box-card">
            <div slot="header" class="clearfix">
              <span>è®¢é˜…ä¸å‘å¸ƒ</span>
            </div>
            <el-form label-width="120px">
              <el-form-item label="è®¢é˜…ä¸»é¢˜">
                <el-input placeholder="ä¾‹å¦‚: Probe/Query/Response/STRESS_TEST_00000"></el-input>
              </el-form-item>
              <el-form-item>
                <el-button type="success">è®¢é˜…</el-button>
              </el-form-item>
              <el-form-item label="æ”¶åˆ°çš„æ¶ˆæ¯">
                <el-input
                  type="textarea"
                  :rows="5"
                  placeholder="ç­‰å¾…æ¶ˆæ¯..."
                  readonly>
                </el-input>
              </el-form-item>
            </el-form>
          </el-card>
        </el-col>
      </el-row>
    </el-main>
  </el-container>
</template>

<script>
// 1. å¼•å…¥ axios ç”¨äºå‰åç«¯é€šä¿¡
import axios from "axios";

// 2. è®¾ç½® axios çš„åŸºç¡€URLï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨åŠ ä¸Š /api å‰ç¼€
// è¿™å¯¹åº”ã€Šå®éªŒæ­¥éª¤.pdfã€‹P9çš„ "axios.defaults.baseURL = "/api";"
// æˆ‘ä»¬åœ¨ vue.config.js ä¸­é…ç½®äº† /api ä»£ç†
axios.defaults.baseURL = "/api";

export default {
  name: "CoreSource",
  data() {
    return {
      // å¯¹åº”ã€Šå®éªŒæ­¥éª¤.pdfã€‹P10 "å‰ç«¯å®šä¹‰è¾“å…¥å˜é‡: connection"
      connection: {
        host: "127.0.0.1",
        port: 1883,
        clientid: "vue_client_" + Math.random().toString(16).substr(2, 8),
      },
      connectStatus: false, // ç”¨äºæ˜¾ç¤ºè¿æ¥çŠ¶æ€
    };
  },
  methods: {
    // 3. onConnect å‡½æ•°ï¼Œå¯¹åº”ã€Šå®éªŒæ­¥éª¤.pdfã€‹P10
    onConnect() {
      console.log("æ­£åœ¨è¿æ¥åˆ°MQTTæœåŠ¡å™¨...");
      // ä½¿ç”¨ axios.post å‘é€æ•°æ®åˆ°åç«¯
      // '/connect/' å¯¹åº”åç«¯ Flask çš„è·¯ç”±
      // {data: this.connection} å¯¹åº”åç«¯ request.get_json()['data']
      axios
        .post("/connect/", { data: this.connection })
        .then((res) => {
          // è¿™é‡Œçš„ res.data å¯¹åº”åç«¯ `return {'rc_status': ...}`
          console.log("åç«¯è¿”å›çš„æ•°æ®:", res.data);
          // æˆ‘ä»¬ç”¨ rc_status çš„å†…å®¹æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸ
          if (res.data && res.data.rc_status === "success") {
            this.connectStatus = true;
            console.log("è¿æ¥æˆåŠŸï¼");
            this.$message({
              message: 'MQTTæœåŠ¡å™¨è¿æ¥æˆåŠŸï¼',
              type: 'success'
            });
          } else {
            this.connectStatus = false;
            this.$message.error('è¿æ¥å¤±è´¥: ' + res.data.rc_status);
          }
        })
        .catch((err) => {
          // å¦‚æœåç«¯æœåŠ¡æ²¡å¯åŠ¨æˆ–å‡ºé”™ï¼Œä¼šåœ¨è¿™é‡Œæ•è·
          console.error("è¿æ¥è¯·æ±‚å¤±è´¥:", err);
          this.connectStatus = false;
          this.$message.error('åç«¯æœåŠ¡è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥Pythonåç«¯æ˜¯å¦å·²è¿è¡Œã€‚');
        });
    },
    onDisconnect() {
      // (åŠŸèƒ½å¾…å®šï¼Œç›®å‰ä»…ç”¨äºå‰ç«¯æ¼”ç¤º)
      console.log("æ–­å¼€è¿æ¥");
      this.connectStatus = false;
      this.$message({
        message: 'å·²æ–­å¼€è¿æ¥ï¼ˆå‰ç«¯æ¨¡æ‹Ÿï¼‰',
        type: 'info'
      });
      // å®é™…å¼€å‘ä¸­ï¼Œè¿™é‡Œä¹Ÿåº”è¯¥å‘åç«¯å‘é€ä¸€ä¸ª /disconnect/ è¯·æ±‚
    }
  },
};
</script>

<style scoped>
.el-header {
  background-color: #b3c0d1;
  color: #333;
  line-height: 60px;
}
.box-card {
  text-align: left;
}
</style>
```

-----

### 3.2 åç«¯ (Python) ä»£ç ç¼–å†™

ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®**æ ¹ç›®å½•**ï¼ˆ`juiceyang999/class2up/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc/`ï¼‰ä¸‹ï¼Œ**æ–°å»º**ä¸€ä¸ªåä¸º `pyt` çš„æ–‡ä»¶å¤¹ã€‚

ç„¶åï¼Œåœ¨ `pyt` æ–‡ä»¶å¤¹ä¸­**æ–°å»º**ä¸€ä¸ª `backend.py` æ–‡ä»¶ã€‚

#### 3.2.1 å®‰è£… Python ä¾èµ–

å½“æ‚¨å›åˆ°ä¸»æœºæ—¶ï¼Œéœ€è¦å…ˆä¸ºæ‚¨çš„Pythonç¯å¢ƒå®‰è£… `Flask`ï¼ˆWebæ¡†æ¶ï¼‰ã€`flask-cors`ï¼ˆè§£å†³è·¨åŸŸï¼‰ã€`flask-mqtt`ï¼ˆè¿æ¥MQTTï¼‰å’Œ `pymysql`ï¼ˆåç»­è¿æ¥MySQLæ—¶ä½¿ç”¨ï¼‰ã€‚

**å®‰è£…å‘½ä»¤ï¼š**

```bash
pip install Flask flask-cors flask-mqtt pymysql
```

#### 3.2.2 ç¼–å†™ `backend.py` ä»£ç 

è¯·å°†ä»¥ä¸‹ä»£ç **å¤åˆ¶**åˆ° `backend.py` æ–‡ä»¶ä¸­ã€‚

**æ–‡ä»¶è·¯å¾„ï¼š** `juiceyang999/class2up/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc/pyt/backend.py`

```python
from flask import Flask, request, jsonify
from flask_cors import CORS
from flask_mqtt import Mqtt
import time

# 1. åˆå§‹åŒ– Flask åº”ç”¨
app = Flask(__name__)
# å…è®¸æ‰€æœ‰åŸŸåçš„è·¨åŸŸè¯·æ±‚ï¼ˆåœ¨å¼€å‘ä¸­å¾ˆæœ‰ç”¨ï¼‰
CORS(app)

# 2. é…ç½® Flask-MQTT
# æˆ‘ä»¬å…ˆè®¾ç½®é»˜è®¤å€¼ï¼Œç¨åä¼šç”¨å‰ç«¯ä¼ æ¥çš„æ•°æ®è¦†ç›–å®ƒä»¬
app.config['MQTT_BROKER_URL'] = '127.0.0.1'  # é»˜è®¤æœåŠ¡å™¨åœ°å€
app.config['MQTT_BROKER_PORT'] = 1883       # é»˜è®¤ç«¯å£
app.config['MQTT_CLIENT_ID'] = 'flask_mqtt_client'
app.config['MQTT_KEEPALIVE'] = 60
app.config['MQTT_TLS_ENABLED'] = False

# 3. åˆå§‹åŒ– MQTT å®¢æˆ·ç«¯
mqtt = Mqtt(app)

# --- MQTT äº‹ä»¶å›è°ƒ ---
# å½“è¿æ¥æˆåŠŸæ—¶
@mqtt.on_connect()
def handle_connect(client, userdata, flags, rc):
    if rc == 0:
        print("MQTT è¿æ¥æˆåŠŸ (rc=0)")
    else:
        print(f"MQTT è¿æ¥å¤±è´¥ï¼Œè¿”å›ç : {rc}")

# å½“æ”¶åˆ°æ¶ˆæ¯æ—¶ (æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥ä»»åŠ¡ä¸­ç”¨åˆ°)
@mqtt.on_message()
def handle_message(client, userdata, message):
    data = dict(
        topic=message.topic,
        payload=message.payload.decode()
    )
    print(f"æ”¶åˆ°æ¶ˆæ¯: {data}")

# --- Flask API è·¯ç”± ---

# 4. åˆ›å»º /connect/ æ¥å£ï¼Œå¯¹åº”ã€Šå®éªŒæ­¥éª¤.pdfã€‹P10
@app.route('/connect/', methods=['POST', 'GET'])
def make_connect():
    try:
        # 5. æ¥æ”¶å‰ç«¯å‘æ¥çš„JSONæ•°æ®
        # å¯¹åº” axios.post ä¸­çš„ {data: this.connection}
        data_connect = request.get_json()['data']
        
        # 6. åœ¨åç«¯æ§åˆ¶å°æ‰“å°æ”¶åˆ°çš„æ•°æ®
        print(f"æ”¶åˆ°æ¥è‡ªå‰ç«¯çš„è¿æ¥è¯·æ±‚: {data_connect}")

        # 7. æ›´æ–° MQTT é…ç½®å¹¶å°è¯•è¿æ¥
        app.config['MQTT_BROKER_URL'] = data_connect['host']
        app.config['MQTT_BROKER_PORT'] = data_connect['port']
        app.config['MQTT_CLIENT_ID'] = data_connect['clientid']
        
        # é‡æ–°é…ç½®å¹¶è¿æ¥
        mqtt.client.disconnect() # å…ˆæ–­å¼€æ—§è¿æ¥
        mqtt.client._client_id = data_connect['clientid'].encode()
        mqtt.client.reinitialise()
        mqtt.client.connect(data_connect['host'], data_connect['port'])

        print(f"æ­£åœ¨å°è¯•è¿æ¥åˆ° {data_connect['host']}:{data_connect['port']}...")
        
        # 8. å‘å‰ç«¯è¿”å›æˆåŠŸå“åº”
        # å¯¹åº” axios.then(res => ...)
        # æˆ‘ä»¬è¿”å› 'success' å­—ç¬¦ä¸²ï¼Œå‰ç«¯ä¼šæ®æ­¤æ›´æ–° "è¿æ¥çŠ¶æ€"
        return jsonify({'rc_status': 'success'})

    except Exception as e:
        print(f"è¿æ¥å¤±è´¥: {e}")
        # å¦‚æœå‡ºé”™ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯
        return jsonify({'rc_status': str(e)})

# (æˆ‘ä»¬å°†åœ¨ä»»åŠ¡4ä¸­æ·»åŠ  /subscribe/ æ¥å£)

# 9. å¯åŠ¨ Flask æœåŠ¡
if __name__ == '__main__':
    # ç¡®ä¿ç«¯å£ä¸º 5000ï¼Œä»¥åŒ¹é… vue.config.js ä¸­çš„ä»£ç†è®¾ç½®
    app.run(debug=True, host='127.0.0.1', port=5000)
```

-----

### 3.3 è¿è¡Œä¸è°ƒè¯•ï¼ˆå½“æ‚¨å›åˆ°ä¸»æœºæ—¶ï¼‰

1.  **å¯åŠ¨ç¯å¢ƒï¼ˆå…±4ä¸ªï¼‰ï¼š**

      * **ç»ˆç«¯ 1ï¼š** è¿è¡Œ `emqx start` (ä»»åŠ¡ 2.1)ã€‚
      * **ç»ˆç«¯ 2ï¼š** è¿è¡Œ `StressTest-INC-Cloud -n 1 -b 0` (ä»»åŠ¡ 2.2)ï¼Œå¹¶ä¿æŒçª—å£å¼€å¯ã€‚
      * **ç»ˆç«¯ 3ï¼š** `cd` åˆ° VUE é¡¹ç›®ç›®å½• (â€¦`/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc`)ï¼Œè¿è¡Œ `yarn serve`ã€‚
      * **ç»ˆç«¯ 4ï¼š** `cd` åˆ° VUE é¡¹ç›®ç›®å½• (â€¦`/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc`)ï¼Œè¿è¡Œ `python pyt/backend.py`ã€‚

2.  **æµ‹è¯•ï¼š**

      * æ‰“å¼€æµè§ˆå™¨è®¿é—® VUE é¡µé¢ï¼ˆå¦‚ `http://localhost:8080`ï¼‰ã€‚
      * ç‚¹å‡»å¯¼èˆªæ çš„ â€œæ•°æ®é‡‡é›†â€ã€‚
      * è¡¨å•ä¸­åº”å·²å¡«å¥½ `127.0.0.1` å’Œ `1883`ã€‚
      * ç‚¹å‡» â€œè¿æ¥â€ æŒ‰é’®ã€‚
      * **é¢„æœŸç»“æœï¼š**
        1.  VUE é¡µé¢å³ä¸Šè§’å¼¹å‡º â€œMQTTæœåŠ¡å™¨è¿æ¥æˆåŠŸï¼â€ æç¤ºï¼Œâ€œè¿æ¥çŠ¶æ€â€ å˜ä¸º â€œå·²è¿æ¥â€ã€‚
        2.  åœ¨ **ç»ˆç«¯ 4** (Python åç«¯) çš„è¾“å‡ºä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ° `æ”¶åˆ°æ¥è‡ªå‰ç«¯çš„è¿æ¥è¯·æ±‚: ...` å’Œ `MQTT è¿æ¥æˆåŠŸ (rc=0)` çš„æ‰“å°ä¿¡æ¯ã€‚

**ä»»åŠ¡ä¸‰å®Œæˆ**ã€‚æˆ‘ä»¬æˆåŠŸæ‰“é€šäº† VUE -\> Flask -\> MQTT Broker çš„æ•´æ¡é“¾è·¯ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å¼€å§‹**ä»»åŠ¡å››ï¼šå®ç°æ•°æ®å¯è§†åŒ– (Echarts)**ã€‚æˆ‘ä»¬å°†ä¿®æ”¹åç«¯ä»¥è®¢é˜…æ•°æ®ï¼Œå¹¶ä¿®æ”¹å‰ç«¯ `ShowData.vue` é¡µé¢ä»¥æ¥æ”¶å¹¶æ˜¾ç¤ºæ•°æ®ã€‚

---

## **ä»»åŠ¡å››ï¼šWeb ç½‘é¡µçš„è®¾è®¡ä¸æ•°æ®å¯è§†åŒ–**

æ­¤ä»»åŠ¡çš„ç›®æ ‡æ˜¯ï¼š

1.  **è®¢é˜…æ•°æ®ï¼š** è®©åç«¯è®¢é˜… MQTT ä¸»é¢˜ä»¥æ¥æ”¶æ•°æ®ã€‚
2.  **è¯·æ±‚æ•°æ®ï¼š** ä»å‰ç«¯æŒ‰æ—¶å‘èµ·æ•°æ®è¯·æ±‚ï¼ˆå‘å¸ƒæ¶ˆæ¯ï¼‰ã€‚
3.  **è·å–æ•°æ®ï¼š** åç«¯å°†æ”¶åˆ°çš„æ•°æ®ä¼ é€’ç»™å‰ç«¯ã€‚
4.  **å¯è§†åŒ–ï¼š** å‰ç«¯ `ShowData.vue` é¡µé¢ä½¿ç”¨ `Echarts` å®æ—¶æ˜¾ç¤ºæ•°æ®ã€‚

æˆ‘ä»¬å°†é‡‡ç”¨â€œ**å‰ç«¯å®šæ—¶è½®è¯¢**â€çš„æ–¹å¼ï¼š

  * å‰ç«¯ `ShowData.vue` é¡µé¢æ¯éš”3ç§’å‘åç«¯ **å‘å¸ƒ** ä¸€ä¸ªæ•°æ®è¯·æ±‚ã€‚
  * åŒæ—¶ï¼Œ`ShowData.vue` å‘åç«¯ **è·å–** ä¸Šä¸€æ¬¡æ”¶åˆ°çš„æ•°æ®ã€‚
  * åç«¯ `backend.py` è´Ÿè´£è®¢é˜…å’Œæ”¶å‘æ¶ˆæ¯ï¼Œå¹¶æš‚å­˜æ•°æ®ã€‚

-----

### 4.1 å®‰è£… Echarts ä¾èµ–

åœ¨æ‚¨å›åˆ°ä¸»æœºåï¼Œè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆ`.../class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc/`ï¼‰æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… `echarts`ï¼š

```bash
yarn add echarts
```

*(è¿™ä¼šæ›´æ–°æ‚¨çš„ `package.json` å’Œ `yarn.lock` æ–‡ä»¶)*

-----

### 4.2 åç«¯ (Python) ä»£ç æ›´æ–°

æˆ‘ä»¬éœ€è¦å¤§å¹…æ›´æ–° `backend.py`ï¼Œä½¿å…¶å…·å¤‡ **è®¢é˜…**ã€**å‘å¸ƒ** å’Œ **æ•°æ®æš‚å­˜/æä¾›** çš„èƒ½åŠ›ã€‚

è¯·**æ›¿æ¢** `pyt/backend.py` æ–‡ä»¶çš„**å…¨éƒ¨å†…å®¹**ä¸ºä»¥ä¸‹ä»£ç ï¼š

**æ–‡ä»¶è·¯å¾„ï¼š** `juiceyang999/class2up/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc/pyt/backend.py`

```python
from flask import Flask, request, jsonify
from flask_cors import CORS
from flask_mqtt import Mqtt
import json # å¼•å…¥ json åº“

# 1. åˆå§‹åŒ– Flask åº”ç”¨
app = Flask(__name__)
CORS(app)

# 2. é…ç½® Flask-MQTT
app.config['MQTT_BROKER_URL'] = '127.0.0.1'
app.config['MQTT_BROKER_PORT'] = 1883
app.config['MQTT_CLIENT_ID'] = 'flask_mqtt_client'
app.config['MQTT_KEEPALIVE'] = 60
app.config['MQTT_TLS_ENABLED'] = False

# 3. åˆå§‹åŒ– MQTT å®¢æˆ·ç«¯
mqtt = Mqtt(app)

# 4. (æ–°å¢) å…¨å±€å˜é‡ï¼Œç”¨äºæš‚å­˜ä»MQTTæ”¶åˆ°çš„æœ€æ–°æ•°æ®
# æˆ‘ä»¬ä½¿ç”¨å­—å…¸ï¼Œä»¥æ•°æ®IDä¸ºé”®ï¼Œæ–¹ä¾¿å‰ç«¯æŒ‰IDæŸ¥è¯¢
latest_data_store = {}

# --- MQTT äº‹ä»¶å›è°ƒ ---

@mqtt.on_connect()
def handle_connect(client, userdata, flags, rc):
    if rc == 0:
        print("MQTT è¿æ¥æˆåŠŸ (rc=0)")
        # 5. (æ–°å¢) ä¸€æ—¦è¿æ¥æˆåŠŸï¼Œç«‹åˆ»è®¢é˜…â€œå“åº”â€ä¸»é¢˜
        # è¿™æ˜¯è™šæ‹Ÿæ•°æ§ç³»ç»Ÿè¿”å›æ•°æ®çš„ä¸»é¢˜
        response_topic = "Query/Response/STRESS_TEST_00000"
        mqtt.subscribe(response_topic)
        print(f"å·²è‡ªåŠ¨è®¢é˜…ä¸»é¢˜: {response_topic}")
    else:
        print(f"MQTT è¿æ¥å¤±è´¥ï¼Œè¿”å›ç : {rc}")

@mqtt.on_message()
def handle_message(client, userdata, message):
    # 6. (æ›´æ–°) å½“æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œè§£æå¹¶å­˜å‚¨å®ƒ
    try:
        payload_str = message.payload.decode()
        print(f"æ”¶åˆ°æ¶ˆæ¯ (Topic: {message.topic}): {payload_str}")
        
        # è§£æJSONæ•°æ®
        data = json.loads(payload_str)
        
        # æ ¹æ®ã€Šé¡¹ç›®è¯¾ç¨‹2025.pdfã€‹P30 çš„æ•°æ®æ ¼å¼ {"values":[{"id":"...","values":[...]}]}
        if 'values' in data and isinstance(data['values'], list):
            for item in data['values']:
                if 'id' in item and 'values' in item:
                    # æˆ‘ä»¬åªå­˜å‚¨æœ€æ–°çš„å€¼
                    latest_data_store[item['id']] = item['values'][0] # å‡è®¾æˆ‘ä»¬åªå…³å¿ƒç¬¬ä¸€ä¸ªå€¼
            
            print(f"å·²æ›´æ–°æ•°æ®å­˜å‚¨: {latest_data_store}")

    except Exception as e:
        print(f"å¤„ç†æ¶ˆæ¯å¤±è´¥: {e}")

# --- Flask API è·¯ç”± ---

@app.route('/connect/', methods=['POST', 'GET'])
def make_connect():
    try:
        data_connect = request.get_json()['data']
        print(f"æ”¶åˆ°æ¥è‡ªå‰ç«¯çš„è¿æ¥è¯·æ±‚: {data_connect}")

        app.config['MQTT_BROKER_URL'] = data_connect['host']
        app.config['MQTT_BROKER_PORT'] = data_connect['port']
        app.config['MQTT_CLIENT_ID'] = data_connect['clientid']
        
        # é‡æ–°é…ç½®å¹¶è¿æ¥
        # æ³¨æ„ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ›´å¥å£®çš„è¿æ¥ç®¡ç†æ˜¯å¿…è¦çš„
        if mqtt.client.is_connected():
            mqtt.client.disconnect()
            
        mqtt.client.username_pw_set(None, None) # æ¸…é™¤æ—§å‡­è¯
        mqtt.client._client_id = data_connect['clientid'].encode()
        mqtt.client.reinitialise()
        mqtt.client.connect(data_connect['host'], data_connect['port'])

        print(f"æ­£åœ¨å°è¯•è¿æ¥åˆ° {data_connect['host']}:{data_connect['port']}...")
        return jsonify({'rc_status': 'success'})

    except Exception as e:
        print(f"è¿æ¥å¤±è´¥: {e}")
        return jsonify({'rc_status': str(e)})

# 7. (æ–°å¢) /publish/ æ¥å£
# ç”¨äºè®©å‰ç«¯â€œè¯·æ±‚â€è™šæ‹Ÿæ•°æ§ç³»ç»Ÿå‘é€æ•°æ®
@app.route('/publish/', methods=['POST'])
def do_publish():
    try:
        data = request.get_json()
        topic = data.get('topic')
        payload = data.get('payload', "{}") # payload åº”è¯¥æ˜¯ JSON å­—ç¬¦ä¸²
        
        if not topic:
            return jsonify({'status': 'error', 'message': 'Topic is required'}), 400
            
        print(f"æ­£åœ¨å‘å¸ƒæ¶ˆæ¯åˆ° (Topic: {topic}): {payload}")
        mqtt.publish(topic, payload)
        
        return jsonify({'status': 'published', 'topic': topic})
    except Exception as e:
        print(f"å‘å¸ƒå¤±è´¥: {e}")
        return jsonify({'status': 'error', 'message': str(e)}), 500

# 8. (æ–°å¢) /get_data/ æ¥å£
# ç”¨äºè®©å‰ç«¯è·å–å·²å­˜å‚¨çš„æœ€æ–°æ•°æ®
@app.route('/get_data/', methods=['POST'])
def get_data():
    try:
        data = request.get_json()
        data_id = data.get('id') # å‰ç«¯å°†è¯·æ±‚ç‰¹å®šIDçš„æ•°æ®
        
        if not data_id:
            return jsonify({'status': 'error', 'message': 'ID is required'}), 400
        
        # ä»æˆ‘ä»¬çš„å­˜å‚¨ä¸­è·å–æœ€æ–°å€¼
        value = latest_data_store.get(data_id)
        
        if value is not None:
            return jsonify({'status': 'ok', 'id': data_id, 'value': value})
        else:
            return jsonify({'status': 'not_found', 'id': data_id, 'value': None})
            
    except Exception as e:
        print(f"è·å–æ•°æ®å¤±è´¥: {e}")
        return jsonify({'status': 'error', 'message': str(e)}), 500

# 9. å¯åŠ¨ Flask æœåŠ¡
if __name__ == '__main__':
    app.run(debug=True, host='127.0.0.1', port=5000)
```

-----

### 4.3 å‰ç«¯ (VUE) ç•Œé¢ä¿®æ”¹

#### 4.3.1 ä¿®æ”¹ `CoreSource.vue`ï¼ˆæ•°æ®é‡‡é›†ç•Œé¢ï¼‰

æˆ‘ä»¬éœ€è¦åœ¨ `CoreSource.vue` é¡µé¢æ·»åŠ â€œå‘å¸ƒæ•°æ®è¯·æ±‚â€çš„åŠŸèƒ½ï¼Œä»¥æ¨¡æ‹Ÿã€Šå®éªŒæ­¥éª¤.pdfã€‹P2 ä¸­ MQTTX çš„â€œå‘å¸ƒâ€æ“ä½œã€‚

è¯·**æ›¿æ¢** `src/components/CoreSource.vue` æ–‡ä»¶çš„**å…¨éƒ¨å†…å®¹**ä¸ºä»¥ä¸‹ä»£ç ï¼š

**æ–‡ä»¶è·¯å¾„ï¼š** `juiceyang999/class2up/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc/src/components/CoreSource.vue`

```vue
<template>
  <el-container>
    <el-header>
      <h2>æ•°æ®é‡‡é›†ä¸æœåŠ¡å™¨è¿æ¥</h2>
    </el-header>
    <el-main>
      <el-row :gutter="20">
        <el-col :span="12">
          <el-card class="box-card">
            <div slot="header" class="clearfix">
              <span>MQTT æœåŠ¡å™¨è¿æ¥é…ç½®</span>
            </div>
            <el-form ref="form" :model="connection" label-width="120px">
              <el-form-item label="æœåŠ¡å™¨åœ°å€">
                <el-input v-model="connection.host"></el-input>
              </el-form-item>
              <el-form-item label="ç«¯å£å·">
                <el-input v-model.number="connection.port" type="number"></el-input>
              </el-form-item>
              <el-form-item label="Client ID">
                <el-input v-model="connection.clientid"></el-input>
              </el-form-item>
              <el-form-item>
                <el-button type="primary" @click="onConnect">è¿æ¥</el-button>
                <el-button @click="onDisconnect" :disabled="!connectStatus">æ–­å¼€</el-button>
              </el-form-item>
              <el-form-item label="è¿æ¥çŠ¶æ€">
                <el-tag :type="connectStatus ? 'success' : 'danger'">
                  {{ connectStatus ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}
                </el-tag>
              </el-form-item>
            </el-form>
          </el-card>
        </el-col>
        
        <el-col :span="12">
          <el-card class="box-card">
            <div slot="header" class="clearfix">
              <span>(è°ƒè¯•) æ‰‹åŠ¨å‘å¸ƒæ•°æ®è¯·æ±‚</span>
            </div>
            <el-form label-width="120px">
              <el-form-item label="è¯·æ±‚ä¸»é¢˜">
                <el-input v-model="publish.topic"></el-input>
              </el-form-item>
              <el-form-item label="è¯·æ±‚ Payload">
                <el-input type="textarea" :rows="3" v-model="publish.payload"></el-input>
              </el-form-item>
              <el-form-item>
                <el-button type="warning" @click="onPublish" :disabled="!connectStatus">
                  æ‰‹åŠ¨å‘å¸ƒ
                </el-button>
              </el-form-item>
            </el-form>
            <div style="font-size: 12px; color: #909399;">
              <p>è¯´æ˜ï¼šåç«¯è¿æ¥æˆåŠŸåä¼šè‡ªåŠ¨è®¢é˜…å“åº”ä¸»é¢˜ã€‚æ­¤å¡ç‰‡ä»…ç”¨äºæ‰‹åŠ¨è°ƒè¯•æ•°æ®è¯·æ±‚ã€‚</p>
              <p>ä¾‹å¦‚ï¼Œæ ¹æ®ã€Šå®éªŒæ­¥éª¤.pdfã€‹P2ï¼ŒPayload å¯å¡«ï¼š</p>
              <p>{"ids":[{"id":"0103502202"}]}</p>
            </div>
          </el-card>
        </el-col>
      </el-row>
    </el-main>
  </el-container>
</template>

<script>
import axios from "axios";
axios.defaults.baseURL = "/api";

export default {
  name: "CoreSource",
  data() {
    return {
      connection: {
        host: "127.0.0.1",
        port: 1883,
        clientid: "vue_client_" + Math.random().toString(16).substr(2, 8),
      },
      connectStatus: false,
      // (æ–°å¢) å­˜å‚¨å‘å¸ƒä¿¡æ¯
      publish: {
        topic: "Query/Request/STRESS_TEST_00000",
        // '0103502202' æ˜¯Xè½´å®é™…é€Ÿåº¦
        payload: '{"ids":[{"id":"0103502202"}]}' 
      }
    };
  },
  methods: {
    onConnect() {
      console.log("æ­£åœ¨è¿æ¥åˆ°MQTTæœåŠ¡å™¨...");
      axios
        .post("/connect/", { data: this.connection })
        .then((res) => {
          if (res.data && res.data.rc_status === "success") {
            this.connectStatus = true;
            this.$message.success('MQTTæœåŠ¡å™¨è¿æ¥æˆåŠŸï¼');
          } else {
            this.connectStatus = false;
            this.$message.error('è¿æ¥å¤±è´¥: ' + res.data.rc_status);
          }
        })
        .catch((err) => {
          console.error("è¿æ¥è¯·æ±‚å¤±è´¥:", err);
          this.connectStatus = false;
          this.$message.error('åç«¯æœåŠ¡è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥Pythonåç«¯æ˜¯å¦å·²è¿è¡Œã€‚');
        });
    },
    onDisconnect() {
      // (åŠŸèƒ½å¾…å®šï¼Œç›®å‰ä»…ç”¨äºå‰ç«¯æ¼”ç¤º)
      console.log("æ–­å¼€è¿æ¥");
      this.connectStatus = false;
      this.$message.info('å·²æ–­å¼€è¿æ¥ï¼ˆå‰ç«¯æ¨¡æ‹Ÿï¼‰');
      // å®é™…å¼€å‘ä¸­ï¼Œè¿™é‡Œä¹Ÿåº”è¯¥å‘åç«¯å‘é€ä¸€ä¸ª /disconnect/ è¯·æ±‚
    },
    // (æ–°å¢) å‘å¸ƒæ–¹æ³•
    onPublish() {
      axios.post("/publish/", {
        topic: this.publish.topic,
        payload: this.publish.payload
      })
      .then(res => {
        if (res.data && res.data.status === 'published') {
          this.$message.success('è¯·æ±‚å·²å‘å¸ƒï¼è¯·åˆ‡æ¢åˆ°â€œæ•°æ®æ˜¾ç¤ºâ€é¡µé¢æŸ¥çœ‹ã€‚');
        } else {
          this.$message.error('å‘å¸ƒå¤±è´¥: ' + res.data.message);
        }
      })
      .catch(err => {
        this.$message.error('å‘å¸ƒè¯·æ±‚å¤±è´¥: ' + err);
      });
    }
  },
};
</script>

<style scoped>
.el-header {
  background-color: #b3c0d1;
  color: #333;
  line-height: 60px;
}
.box-card {
  text-align: left;
}
</style>
```

#### 4.3.2 ç¼–å†™ `ShowData.vue`ï¼ˆæ•°æ®æ˜¾ç¤ºç•Œé¢ï¼‰

è¿™æ˜¯æœ¬ä»»åŠ¡çš„æ ¸å¿ƒæ–‡ä»¶ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œåˆå§‹åŒ– Echarts å¹¶å®šæ—¶è¯·æ±‚å’Œåˆ·æ–°æ•°æ®ã€‚

è¯·**æ›¿æ¢** `src/components/ShowData.vue` æ–‡ä»¶çš„**å…¨éƒ¨å†…å®¹**ä¸ºä»¥ä¸‹ä»£ç ï¼š

**æ–‡ä»¶è·¯å¾„ï¼š** `juiceyang999/class2up/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc/src/components/ShowData.vue`

```vue
<template>
  <el-container>
    <el-main>
      <el-card>
        <div slot="header">
          <span>å®æ—¶æ•°æ®æ˜¾ç¤º (Xè½´å®é™…é€Ÿåº¦)</span>
          <span style="font-size: 12px; color: #909399; margin-left: 20px;">
            (æ•°æ®ID: {{ dataIdToFetch }})
          </span>
        </div>
        <div id="data-chart" style="width: 100%; height: 400px;"></div>
      </el-card>
    </el-main>
  </el-container>
</template>

<script>
import axios from "axios";
// 2. å¼•å…¥ Echarts
import * as echarts from "echarts";

axios.defaults.baseURL = "/api";

export default {
  name: "ShowData",
  data() {
    return {
      chart: null, // Echarts å®ä¾‹
      chartData: [], // å­˜å‚¨å›¾è¡¨çš„æ•°æ®
      dataTimer: null, // å­˜å‚¨ setInterval çš„ID
      // 3. æˆ‘ä»¬è¦æŠ“å–çš„æ•°æ®IDï¼šXè½´å®é™…é€Ÿåº¦
      // (æ¥è‡ªã€Šé¡¹ç›®è¯¾ç¨‹2025.pdfã€‹P29, "0103502202" "SPEED" "å®é™…é€Ÿåº¦")
      dataIdToFetch: '0103502202',
      // è¯·æ±‚å‘å¸ƒçš„ä¸»é¢˜å’Œpayload
      publishConfig: {
        topic: "Query/Request/STRESS_TEST_00000",
        payload: '{"ids":[{"id":"0103502202"}]}' // åŠ¨æ€ç”Ÿæˆ
      },
    };
  },
  mounted() {
    // 4. é¡µé¢åŠ è½½æ—¶ï¼šåˆå§‹åŒ–å›¾è¡¨å¹¶å¼€å§‹æŠ“å–æ•°æ®
    // åŠ¨æ€è®¾ç½®æˆ‘ä»¬è¦è¯·æ±‚çš„ID
    this.publishConfig.payload = `{"ids":[{"id":"${this.dataIdToFetch}"}]}`;
    
    this.initChart();
    this.startFetching();
  },
  beforeDestroy() {
    // 5. é¡µé¢é”€æ¯æ—¶ï¼šåœæ­¢å®šæ—¶å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
    if (this.dataTimer) {
      clearInterval(this.dataTimer);
    }
  },
  methods: {
    // 6. åˆå§‹åŒ–å›¾è¡¨
    initChart() {
      // å¯¹åº”ã€Šå®éªŒæ­¥éª¤.pdfã€‹P12/P13çš„åˆå§‹åŒ–ä»£ç 
      const chartDom = document.getElementById("data-chart");
      this.chart = echarts.init(chartDom);
      
      const option = {
        xAxis: {
          type: "category",
          data: [], // Xè½´æ•°æ®ï¼ˆæ—¶é—´æˆ³æˆ–ç´¢å¼•ï¼‰
        },
        yAxis: {
          type: "value",
          scale: true // è‡ªåŠ¨ç¼©æ”¾
        },
        series: [
          {
            data: [], // Yè½´æ•°æ®ï¼ˆé€Ÿåº¦å€¼ï¼‰
            type: "line",
            smooth: true,
          },
        ],
        tooltip: {
          trigger: 'axis'
        }
      };
      
      this.chart.setOption(option);
    },
    
    // 7. å¼€å§‹è½®è¯¢
    startFetching() {
      // æ¯3ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡ requestAndFetch
      this.requestAndFetch(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
      this.dataTimer = setInterval(this.requestAndFetch, 3000); // 3000æ¯«ç§’ = 3ç§’
    },

    // 8. (æ–°å¢) ç»„åˆæ–¹æ³•ï¼šå…ˆè¯·æ±‚ï¼Œå†è·å–
    requestAndFetch() {
      // 8.1. ç¬¬ä¸€æ­¥ï¼šå‘åç«¯å‘è¯·æ±‚ï¼Œè®©åç«¯å» "é—®" è™šæ‹Ÿæ•°æ§æœº
      axios.post("/publish/", this.publishConfig)
        .catch(err => {
          console.error("å‘å¸ƒæ•°æ®è¯·æ±‚å¤±è´¥:", err);
        });

      // 8.2. ç¬¬äºŒæ­¥ï¼šç¨ç­‰ç‰‡åˆ»ï¼ˆä¾‹å¦‚500msï¼‰ï¼Œå†å»åç«¯ "å–" æ•°æ®
      // (ç»™MQTTä¸€ä¸ªæ¥å›çš„æ—¶é—´)
      setTimeout(() => {
        this.fetchData();
      }, 500);
    },

    // 9. (æ–°å¢) ä»åç«¯è·å–æ•°æ®å¹¶æ›´æ–°å›¾è¡¨
    fetchData() {
      axios.post("/get_data/", { id: this.dataIdToFetch })
        .then(res => {
          if (res.data && res.data.status === 'ok' && res.data.value !== null) {
            const newValue = parseFloat(res.data.value); // ç¡®ä¿æ˜¯æ•°å­—
            
            if (this.chartData.length > 50) {
              this.chartData.shift(); 
            }
            this.chartData.push(newValue);
            
            const xAxisData = this.chartData.map((_, index) => index);

            // 9.3. (å·²ä¿®æ­£) æ›´æ–° Echarts å›¾è¡¨
            this.chart.setOption({
              xAxis: {
                data: xAxisData,
              },
              series: [
                {
                  data: this.chartData,
                  type: 'line',    // <--- ï¼ï¼ï¼(ä¿®æ­£) åŠ ä¸Šè¿™ä¸€è¡Œ
                  smooth: true   // <--- ï¼ï¼ï¼(ä¿®æ­£) åŠ ä¸Šè¿™ä¸€è¡Œ
                },
              ],
            });

          } else if (res.data.status === 'not_found') {
            // è¿™å°±æ˜¯ä½ ç°åœ¨åœ¨F12é‡Œçœ‹åˆ°çš„æ—¥å¿—
            console.log(`æ•°æ®ID ${this.dataIdToFetch} å°šæœªæ”¶åˆ°.`); 
          }
        })
        .catch(err => {
          console.error("è·å–æ•°æ®å¤±è´¥:", err);
        });
    }
  },
};
</script>

<style scoped>
/* å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ­¤é¡µé¢ä¸“å±çš„æ ·å¼ */
</style>
```

-----

### 4.4 è¿è¡Œä¸è°ƒè¯•ï¼ˆå½“æ‚¨å›åˆ°ä¸»æœºæ—¶ï¼‰

1.  **å¯åŠ¨ç¯å¢ƒï¼ˆå…±4ä¸ªï¼‰ï¼š** (åŒä»»åŠ¡ä¸‰)

      * **ç»ˆç«¯ 1ï¼š** `emqx start`
      * **ç»ˆç«¯ 2ï¼š** `StressTest-INC-Cloud -n 1 -b 0` (ä¿æŒè¿è¡Œ)
      * **ç»ˆç«¯ 3ï¼š** `yarn serve` (VUE å‰ç«¯)
      * **ç»ˆç«¯ 4ï¼š** `python pyt/backend.py` (Python åç«¯)

2.  **æµ‹è¯•ï¼š**

      * æ‰“å¼€æµè§ˆå™¨è®¿é—® VUE é¡µé¢ï¼ˆå¦‚ `http://localhost:8080`ï¼‰ã€‚
      * **æ­¥éª¤ 1:** ç‚¹å‡»å¯¼èˆªæ  â€œ**æ•°æ®é‡‡é›†**â€ã€‚
      * **æ­¥éª¤ 2:** ç‚¹å‡» â€œ**è¿æ¥**â€ æŒ‰é’®ã€‚ç¡®ä¿æç¤º â€œMQTTæœåŠ¡å™¨è¿æ¥æˆåŠŸï¼â€ã€‚
      * **æ­¥éª¤ 3:** ç‚¹å‡»å¯¼èˆªæ  â€œ**æ•°æ®æ˜¾ç¤º**â€ã€‚
      * **é¢„æœŸç»“æœï¼š**
        1.  æ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªç©ºçš„ Echarts å›¾è¡¨ã€‚
        2.  ç­‰å¾…å‡ ç§’é’Ÿ...
        3.  å›¾è¡¨ä¸Šå¼€å§‹**å®æ—¶**å‡ºç°ä¸€æ¡çº¿ï¼Œå¹¶ä¸æ–­å‘å³æ»šåŠ¨ï¼Œæ˜¾ç¤ºæ¥è‡ªè™šæ‹Ÿæ•°æ§æœºåºŠçš„ "Xè½´å®é™…é€Ÿåº¦" æ•°æ®ã€‚
        4.  åœ¨ **ç»ˆç«¯ 4** (Python åç«¯) ä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ° `æ”¶åˆ°æ¶ˆæ¯...` å’Œ `å·²æ›´æ–°æ•°æ®å­˜å‚¨...` çš„æ‰“å°ä¿¡æ¯ã€‚

**ä»»åŠ¡å››å®Œæˆ**ã€‚æˆ‘ä»¬å·²ç»æˆåŠŸåœ°ä»å‰ç«¯è¯·æ±‚æ•°æ®ï¼Œé€šè¿‡åç«¯ä¸MQTTé€šä¿¡ï¼Œå¹¶å°†è·å–åˆ°çš„å®æ—¶æ•°æ®å±•ç¤ºåœ¨äº†Echartså›¾è¡¨ä¸Šã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›è¡Œ**ä»»åŠ¡äº”ï¼šåŸºäºæ•°æ®åº“çš„æ•°æ®å­˜å‚¨ (MySQL & InfluxDB)**ã€‚

---

## **ä»»åŠ¡äº”ï¼šåŸºäºæ•°æ®åº“çš„æ•°æ®å­˜å‚¨ä¸ç®¡ç†**

æ­¤ä»»åŠ¡çš„ç›®æ ‡æ˜¯å°†æˆ‘ä»¬åœ¨ä»»åŠ¡å››ä¸­è·å–åˆ°çš„å®æ—¶æ•°æ®ï¼ŒåŒæ­¥å†™å…¥åˆ° **MySQL**ï¼ˆå…³ç³»å‹æ•°æ®åº“ï¼‰å’Œ **InfluxDB**ï¼ˆæ—¶åºæ•°æ®åº“ï¼‰ä¸­ã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨åç«¯ `backend.py` æ–‡ä»¶ä¸­å®Œæˆï¼Œå‰ç«¯ VUE é¡µé¢æ— éœ€ä¿®æ”¹ã€‚

è¿™æ˜¯ä¸€ä¸ªçº¯åç«¯çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†åˆ†ä¸‰æ­¥è¿›è¡Œï¼š

1.  **æ•°æ®åº“ç¯å¢ƒå‡†å¤‡**ã€‚
2.  **å®‰è£… Python ä¾èµ–åº“**ã€‚
3.  **ä¿®æ”¹ `backend.py` ä»£ç ** ä»¥å®ç°åŒæ•°æ®åº“å†™å…¥ã€‚

-----

### 5.1 æ•°æ®åº“ç¯å¢ƒå‡†å¤‡ï¼ˆä¸»æœºæ“ä½œæ­¥éª¤ï¼‰

å½“æ‚¨å›åˆ°ä¸»æœºåï¼Œåœ¨å¯åŠ¨ `backend.py` ä¹‹å‰ï¼Œå¿…é¡»å…ˆé…ç½®å¥½ä¸¤ä¸ªæ•°æ®åº“ã€‚

#### 5.1.1 MySQL æ•°æ®åº“é…ç½®

æ ¹æ®ã€Šå®éªŒæ­¥éª¤.pdfã€‹P19-P20ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ Navicat ç­‰å·¥å…·å®Œæˆä»¥ä¸‹æ“ä½œï¼š

1.  **ç¡®ä¿æœåŠ¡è¿è¡Œï¼š** ç¡®ä¿æ‚¨çš„ MySQL æœåŠ¡æ­£åœ¨è¿è¡Œã€‚
2.  **åˆ›å»ºè¿æ¥ï¼š** åœ¨ Navicat ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåˆ° `localhost` (ä¸»æœº)ã€ç«¯å£ `3306`ã€ç”¨æˆ·åä¸º `root`ã€å¹¶è¾“å…¥æ‚¨å¯†ç çš„è¿æ¥ã€‚
3.  **æ–°å»ºæ•°æ®åº“ï¼š** å³é”®ç‚¹å‡»è¿æ¥ï¼Œé€‰æ‹©â€œæ–°å»ºæ•°æ®åº“â€ã€‚
      * æ•°æ®åº“åï¼š`mqtt_data`
      * å­—ç¬¦é›†ï¼š`utf8`
      * æ’åºè§„åˆ™ï¼š`utf8_general_ci`
4.  **æ–°å»ºæ•°æ®è¡¨ï¼š**
      * åŒå‡»è¿›å…¥ `mqtt_data` æ•°æ®åº“ï¼Œå³é”®ç‚¹å‡»â€œè¡¨â€ï¼Œé€‰æ‹©â€œæ–°å»ºè¡¨â€ã€‚
      * æ ¹æ®ã€Šå®éªŒæ­¥éª¤.pdfã€‹P21çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨ï¼ˆæˆ‘å»ºè®®æ·»åŠ ä¸€ä¸ª `id` ä¸»é”®å’Œ `data_id` å­—æ®µä»¥ä¾¿åŒºåˆ†æ•°æ®ï¼‰ï¼š
        * `id`ï¼šç±»å‹ `INT`ï¼Œå‹¾é€‰ `è‡ªåŠ¨é€’å¢` (Auto Increment)ï¼Œè®¾ä¸º `ä¸»é”®`ã€‚
        * `data_id`ï¼šç±»å‹ `VARCHAR(50)` (ä¾‹å¦‚ '0103502202')ã€‚
        * `payload`ï¼šç±»å‹ `VARCHAR(255)` (ç”¨äºå­˜å‚¨æ•°æ®å€¼)ã€‚
        * `time`ï¼šç±»å‹ `DATETIME` (ç”¨äºå­˜å‚¨æ—¶é—´æˆ³)ã€‚
      * ç‚¹å‡»â€œä¿å­˜â€ï¼Œè¡¨åå¡«å†™ï¼š`mac_data`ã€‚

#### 5.1.2 InfluxDB (è¾¹ç¼˜ç«¯) é…ç½®

æ ¹æ®ã€Šå®éªŒæ­¥éª¤.pdfã€‹P14-P15ï¼Œæ‚¨éœ€è¦å®Œæˆä»¥ä¸‹æ“ä½œï¼š
**å®‰è£…Influxdb**ï¼š
https://docs.influxdata.com/influxdb/v2/install/?t=Windows#download-and-install-influxdb-v2

1.  **å¯åŠ¨æœåŠ¡ï¼š**
      * æ‰“å¼€ `cmd`ï¼Œ`cd` åˆ°æ‚¨çš„ InfluxDB é…ç½®æ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ `E:\MQTT-test\Influxdbé…ç½®æ–‡ä»¶`ï¼‰ã€‚
      * è¿è¡Œå‘½ä»¤ï¼š`influxd`
      * **ä¿æŒæ­¤ `cmd` çª—å£å¼€å¯**ã€‚
2.  **Webç«¯é…ç½®ï¼š**
      * æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® `http://localhost:8086`ã€‚
      * æ‚¨å°†çœ‹åˆ° InfluxDB çš„**é¦–æ¬¡è®¾ç½®ç•Œé¢**ã€‚
      * è®¾ç½®æ‚¨çš„**ç”¨æˆ·å**ã€**å¯†ç **ã€**ç»„ç»‡åç§°** (Organization, ä¾‹å¦‚ `my-org`) å’Œ**å­˜å‚¨æ¡¶åç§°** (Bucket, ä¾‹å¦‚ `mqtt_bucket`)ã€‚
3.  **è·å– Tokenï¼š**
      * è®¾ç½®å®Œæˆåï¼Œæ‚¨ä¼šè¿›å…¥ InfluxDB çš„ä¸»ç•Œé¢ã€‚
      * åœ¨å·¦ä¾§èœå•æ æ‰¾åˆ° `Data` -\> `API Tokens`ã€‚
      * æ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªä¸ºæ‚¨è‡ªåŠ¨ç”Ÿæˆçš„ `<username>'s Token`ã€‚
      * ç‚¹å‡»å®ƒï¼Œç„¶åç‚¹å‡» â€œCopy to Clipboardâ€ **å¤åˆ¶è¿™ä¸ª Token**ã€‚
      * **å°†è¿™ä¸ª Token å­—ç¬¦ä¸²**ã€æ‚¨çš„\*\*ç»„ç»‡åç§°(Org)**å’Œ**å­˜å‚¨æ¡¶åç§°(Bucket)\*\*ä¿å­˜å¥½ï¼Œæˆ‘ä»¬é©¬ä¸Šè¦åœ¨ `backend.py` ä¸­ä½¿ç”¨å®ƒä»¬ã€‚

-----

### 5.2 å®‰è£… Python ä¾èµ–åº“

æ‚¨éœ€è¦å®‰è£…ç”¨äºè¿æ¥ InfluxDB v2 çš„ Python å®¢æˆ·ç«¯ï¼ˆ`pymysql` æˆ‘ä»¬åœ¨ä»»åŠ¡ä¸‰å·²å®‰è£…ï¼‰ã€‚

å½“æ‚¨å›åˆ°ä¸»æœºåï¼Œè¯·åœ¨**ç»ˆç«¯ 4** (è¿è¡Œåç«¯çš„ç»ˆç«¯) ä¸­ï¼Œ`cd` åˆ° VUE é¡¹ç›®æ ¹ç›®å½•ï¼Œå¹¶æ‰§è¡Œï¼š

```bash
pip install influxdb-client
```

-----

### 5.3 åç«¯ (Python) ä»£ç æ›´æ–°

ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¿®æ”¹ `backend.py`ï¼Œåœ¨ `handle_message` å‡½æ•°ä¸­ï¼ˆå³æ¯æ¬¡æ”¶åˆ°MQTTæ¶ˆæ¯æ—¶ï¼‰æ·»åŠ å°†æ•°æ®å†™å…¥è¿™ä¸¤ä¸ªæ•°æ®åº“çš„é€»è¾‘ã€‚

è¯·**æ›¿æ¢** `pyt/backend.py` æ–‡ä»¶çš„**å…¨éƒ¨å†…å®¹**ä¸ºä»¥ä¸‹ä»£ç ï¼š

**æ–‡ä»¶è·¯å¾„ï¼š** `juiceyang999/class2up/class2up-9730b2fcdf474be54786a1f787cc6b005a26d2fc/pyt/backend.py`

```python
from flask import Flask, request, jsonify
from flask_cors import CORS
from flask_mqtt import Mqtt
import json
import pymysql       # (æ–°å¢) å¼•å…¥ MySQL åº“
import datetime      # (æ–°å¢) å¼•å…¥æ—¶é—´åº“
from influxdb_client import InfluxDBClient, Point, WritePrecision # (æ–°å¢) å¼•å…¥ InfluxDB åº“
from influxdb_client.client.write_api import SYNCHRONOUS

# --- (æ–°å¢) æ•°æ®åº“é…ç½® ---
# 1. MySQL é…ç½® (è¯·æ ¹æ®æ‚¨çš„è®¾ç½®ä¿®æ”¹)
MYSQL_HOST = 'localhost'
MYSQL_USER = 'root'
MYSQL_PASSWORD = 'xjtu2025'  # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨çš„MySQLå¯†ç ï¼ï¼ï¼
MYSQL_DB = 'mqtt_data'
MYSQL_PORT = 3306

# 2. InfluxDB v2 é…ç½® (è¯·æ ¹æ®æ‚¨åœ¨ 5.1.2 ä¸­è®¾ç½®å’Œå¤åˆ¶çš„å€¼ä¿®æ”¹)
INFLUX_URL = "http://localhost:8086"
INFLUX_TOKEN = "YOUR_API_TOKEN_HERE"  # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨å¤åˆ¶çš„ Tokenï¼ï¼ï¼
INFLUX_ORG = "my-org"                 # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨çš„ç»„ç»‡åç§°ï¼ï¼ï¼
INFLUX_BUCKET = "mqtt_bucket"         # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨çš„å­˜å‚¨æ¡¶åç§°ï¼ï¼ï¼

# 3. (æ–°å¢) åˆå§‹åŒ– InfluxDB å®¢æˆ·ç«¯
try:
    influx_client = InfluxDBClient(url=INFLUX_URL, token=INFLUX_TOKEN, org=INFLUX_ORG)
    # ä½¿ç”¨åŒæ­¥å†™å…¥æ¨¡å¼
    write_api = influx_client.write_api(write_options=SYNCHRONOUS)
    print("InfluxDB å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸã€‚")
except Exception as e:
    print(f"InfluxDB å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥: {e}")
# -------------------------

# åˆå§‹åŒ– Flask åº”ç”¨
app = Flask(__name__)
CORS(app)

# é…ç½® Flask-MQTT
app.config['MQTT_BROKER_URL'] = '127.0.0.1'
app.config['MQTT_BROKER_PORT'] = 1883
app.config['MQTT_CLIENT_ID'] = 'flask_mqtt_client'
app.config['MQTT_KEEPALIVE'] = 60
app.config['MQTT_TLS_ENABLED'] = False

mqtt = Mqtt(app)

# æš‚å­˜æœ€æ–°æ•°æ®
latest_data_store = {}

# --- (æ–°å¢) æ•°æ®åº“å†™å…¥å‡½æ•° ---

def save_to_mysql(data_id, value):
    """
    å°†æ•°æ®ä¿å­˜åˆ° MySQL æ•°æ®åº“
    """
    conn = None
    cur = None
    try:
        # è·å–å½“å‰æ—¶é—´
        time_str = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        # å»ºç«‹è¿æ¥
        conn = pymysql.connect(
            host=MYSQL_HOST,
            user=MYSQL_USER,
            password=MYSQL_PASSWORD,
            database=MYSQL_DB,
            port=MYSQL_PORT,
            charset='utf8'
        )
        # åˆ›å»ºæ¸¸æ ‡
        cur = conn.cursor()
        
        # SQL æ’å…¥è¯­å¥ (ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥)
        sql = "INSERT INTO mac_data (data_id, payload, time) VALUES (%s, %s, %s)"
        
        # æ‰§è¡Œ SQL
        cur.execute(sql, (data_id, str(value), time_str))
        
        # æäº¤äº‹åŠ¡
        conn.commit()
        print(f"MySQL å†™å…¥æˆåŠŸ: ID={data_id}, Value={value}")
        
    except Exception as e:
        print(f"MySQL å†™å…¥å¤±è´¥: {e}")
        if conn:
            conn.rollback() # å‡ºé”™æ—¶å›æ»š
    finally:
        # å…³é—­æ¸¸æ ‡å’Œè¿æ¥
        if cur:
            cur.close()
        if conn:
            conn.close()

def save_to_influxdb(data_id, value):
    """
    å°†æ•°æ®ä¿å­˜åˆ° InfluxDB
    """
    try:
        # è½¬æ¢ä¸º floatï¼ŒInfluxDB æ¨èä½¿ç”¨æ•°å€¼ç±»å‹
        value_float = float(value)
        
        # åˆ›å»ºä¸€ä¸ªæ•°æ®ç‚¹ (Point)
        p = Point("machine_data") \
            .tag("device_id", "STRESS_TEST_00000") \
            .tag("data_id", data_id) \
            .field("value", value_float) \
            .time(datetime.datetime.utcnow(), WritePrecision.NS)
            
        # å†™å…¥æ•°æ®
        write_api.write(bucket=INFLUX_BUCKET, org=INFLUX_ORG, record=p)
        print(f"InfluxDB å†™å…¥æˆåŠŸ: ID={data_id}, Value={value_float}")
        
    except Exception as e:
        print(f"InfluxDB å†™å…¥å¤±è´¥: {e}")

# --- MQTT äº‹ä»¶å›è°ƒ ---

@mqtt.on_connect()
def handle_connect(client, userdata, flags, rc):
    if rc == 0:
        print("MQTT è¿æ¥æˆåŠŸ (rc=0)")
        response_topic = "Query/Response/STRESS_TEST_00000"
        mqtt.subscribe(response_topic)
        print(f"å·²è‡ªåŠ¨è®¢é˜…ä¸»é¢˜: {response_topic}")
    else:
        print(f"MQTT è¿æ¥å¤±è´¥ï¼Œè¿”å›ç : {rc}")

@mqtt.on_message()
def handle_message(client, userdata, message):
    # 4. (æ›´æ–°) å½“æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œè§£æã€å­˜å‚¨ã€å¹¶å†™å…¥æ•°æ®åº“
    try:
        payload_str = message.payload.decode()
        print(f"æ”¶åˆ°æ¶ˆæ¯ (Topic: {message.topic}): {payload_str}")
        
        data = json.loads(payload_str)
        
        if 'values' in data and isinstance(data['values'], list):
            for item in data['values']:
                if 'id' in item and 'values' in item:
                    data_id = item['id']
                    value = item['values'][0] # å‡è®¾æˆ‘ä»¬åªå…³å¿ƒç¬¬ä¸€ä¸ªå€¼
                    
                    # 4.1. æš‚å­˜æ•°æ® (ä¾›å‰ç«¯Echartsä½¿ç”¨)
                    latest_data_store[data_id] = value
                    print(f"å·²æ›´æ–°æ•°æ®å­˜å‚¨: {latest_data_store}")

                    # 4.2. (æ–°å¢) å†™å…¥ MySQL
                    save_to_mysql(data_id, value)
                    
                    # 4.3. (æ–°å¢) å†™å…¥ InfluxDB
                    save_to_influxdb(data_id, value)
            
    except Exception as e:
        print(f"å¤„ç†æ¶ˆæ¯å¤±è´¥: {e}")

# --- Flask API è·¯ç”± (ä¿æŒä¸å˜) ---

@app.route('/connect/', methods=['POST', 'GET'])
def make_connect():
    try:
        data_connect = request.get_json()['data']
        print(f"æ”¶åˆ°æ¥è‡ªå‰ç«¯çš„è¿æ¥è¯·æ±‚: {data_connect}")
        app.config['MQTT_BROKER_URL'] = data_connect['host']
        app.config['MQTT_BROKER_PORT'] = data_connect['port']
        app.config['MQTT_CLIENT_ID'] = data_connect['clientid']
        if mqtt.client.is_connected():
            mqtt.client.disconnect()
        mqtt.client.username_pw_set(None, None)
        mqtt.client._client_id = data_connect['clientid'].encode()
        mqtt.client.reinitialise()
        mqtt.client.connect(data_connect['host'], data_connect['port'])
        print(f"æ­£åœ¨å°è¯•è¿æ¥åˆ° {data_connect['host']}:{data_connect['port']}...")
        return jsonify({'rc_status': 'success'})
    except Exception as e:
        print(f"è¿æ¥å¤±è´¥: {e}")
        return jsonify({'rc_status': str(e)})

@app.route('/publish/', methods=['POST'])
def do_publish():
    try:
        data = request.get_json()
        topic = data.get('topic')
        payload = data.get('payload', "{}")
        if not topic:
            return jsonify({'status': 'error', 'message': 'Topic is required'}), 400
        print(f"æ­£åœ¨å‘å¸ƒæ¶ˆæ¯åˆ° (Topic: {topic}): {payload}")
        mqtt.publish(topic, payload)
        return jsonify({'status': 'published', 'topic': topic})
    except Exception as e:
        print(f"å‘å¸ƒå¤±è´¥: {e}")
        return jsonify({'status': 'error', 'message': str(e)}), 500

@app.route('/get_data/', methods=['POST'])
def get_data():
    try:
        data = request.get_json()
        data_id = data.get('id')
        if not data_id:
            return jsonify({'status': 'error', 'message': 'ID is required'}), 400
        value = latest_data_store.get(data_id)
        if value is not None:
            return jsonify({'status': 'ok', 'id': data_id, 'value': value})
        else:
            return jsonify({'status': 'not_found', 'id': data_id, 'value': None})
    except Exception as e:
        print(f"è·å–æ•°æ®å¤±è´¥: {e}")
        return jsonify({'status': 'error', 'message': str(e)}), 500

# å¯åŠ¨ Flask æœåŠ¡
if __name__ == '__main__':
    app.run(debug=True, host='127.0.0.1', port=5000)
```

-----

### 5.4 è¿è¡Œä¸è°ƒè¯•ï¼ˆå½“æ‚¨å›åˆ°ä¸»æœºæ—¶ï¼‰

1.  **å¯åŠ¨ç¯å¢ƒï¼ˆå…± 5 ä¸ªï¼‰ï¼š**

      * **ç»ˆç«¯ 1ï¼š** è¿è¡Œ `emqx start` (MQTT Broker)ã€‚
      * **ç»ˆç«¯ 2ï¼š** è¿è¡Œ `StressTest-INC-Cloud -n 1 -b 0` (æ•°æ®æº)ã€‚
      * **ç»ˆç«¯ 3ï¼š** è¿è¡Œ `influxd` (InfluxDB æ•°æ®åº“)ã€‚
      * **ç»ˆç«¯ 4ï¼š** è¿è¡Œ `yarn serve` (VUE å‰ç«¯)ã€‚
      * **ç»ˆç«¯ 5ï¼š** **(é‡è¦\!)** ç¡®ä¿æ‚¨å·²å°† `backend.py` ä¸­çš„ `MYSQL_PASSWORD` å’Œ `INFLUX_TOKEN` ä¿®æ”¹ä¸ºæ‚¨è‡ªå·±çš„é…ç½®ã€‚ç„¶åè¿è¡Œ `python pyt/backend.py` (Python åç«¯)ã€‚

2.  **æµ‹è¯•ï¼š**

      * æ‰“å¼€æµè§ˆå™¨è®¿é—® VUE é¡µé¢ï¼ˆå¦‚ `http://localhost:8080`ï¼‰ã€‚
      * ç‚¹å‡» â€œ**æ•°æ®é‡‡é›†**â€ é¡µé¢ï¼Œç‚¹å‡» â€œ**è¿æ¥**â€ï¼Œç¡®ä¿è¿æ¥æˆåŠŸã€‚
      * ç‚¹å‡» â€œ**æ•°æ®æ˜¾ç¤º**â€ é¡µé¢ï¼Œæ‚¨ä¼šçœ‹åˆ° Echarts å›¾è¡¨å¼€å§‹å®æ—¶æ˜¾ç¤ºæ•°æ®ã€‚

3.  **éªŒè¯å­˜å‚¨ï¼š**

      * **MySQL éªŒè¯ï¼š**
        * æ‰“å¼€ **Navicat**ã€‚
        * åˆ·æ–° `mqtt_data` æ•°æ®åº“ä¸‹çš„ `mac_data` è¡¨ã€‚
        * **é¢„æœŸç»“æœï¼š** æ‚¨ä¼šçœ‹åˆ°è¡¨ä¸­**æ¯éš”å‡ ç§’å°±æ–°å¢ä¸€è¡Œæ•°æ®**ï¼ŒåŒ…å« `data_id` ('0103502202')ã€`payload` (é€Ÿåº¦å€¼) å’Œ `time` (æ—¶é—´æˆ³)ã€‚
      * **InfluxDB éªŒè¯ï¼š**
        * æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8086`ã€‚
        * ç‚¹å‡»å·¦ä¾§èœå•çš„ `Explore` (Data Explorer)ã€‚
        * åœ¨æŸ¥è¯¢æ„å»ºå™¨ (Query Builder) ä¸­ï¼š
          * **FROM:** é€‰æ‹©æ‚¨çš„å­˜å‚¨æ¡¶ `mqtt_bucket`ã€‚
          * **Filter (Measurement):** é€‰æ‹© `machine_data`ã€‚
          * **Filter (Field):** é€‰æ‹© `value`ã€‚
          * **Filter (Tag):** é€‰æ‹© `data_id` = `0103502202`ã€‚
        * ç‚¹å‡» â€œ**Submit**â€ã€‚
        * **é¢„æœŸç»“æœï¼š** æ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªä¸ VUE é¡µé¢ä¸­ Echarts å‡ ä¹ä¸€æ ·çš„å®æ—¶å›¾è¡¨ï¼Œè¯æ˜æ—¶åºæ•°æ®å·²æˆåŠŸå†™å…¥ã€‚

### è¡¥å……ï¼šäº‘ç«¯ Influxdb æ—¶åºæ•°æ®åº“å­˜å‚¨

**æ€»è¿°ï¼š**
æ‰“å¼€äº‘ç«¯ Influxdb æ—¶åºæ•°æ®åº“æœåŠ¡ç½‘é¡µ https://us-east-1-1.aws.cloud2.influxdata.comï¼Œæ³¨å†Œè´¦å·ç™»å½•ã€‚ç‚¹å‡» buckets å¯ä»¥è®¾ç½®æ•°æ®å­˜å‚¨æ¡¶ï¼Œä¸è¾¹ç¼˜ç«¯ç›¸åŒã€‚ç‚¹å‡» source-node è¿›å…¥é…ç½®ç•Œé¢ã€‚æ ¹æ®æŒ‡å¼•å¯ä»¥è¿›è¡Œç¼–ç¨‹ï¼Œä¹Ÿå¯å‚è€ƒæœ¬åœ°æ•°æ®åº“é…ç½®ä»£ç ï¼ŒåŠŸèƒ½ç›¸åŒã€‚åœ¨ Dataexplorerä¸­å¯ä»¥æŸ¥çœ‹ä¸Šä¼ çš„æ•°æ®ã€‚

***è§â€œä»»åŠ¡äº”ï¼ˆè¡¥å……ï¼‰ï¼šæ­å»ºäº‘ç«¯inflexdb.mdâ€***

---

## ä»»åŠ¡äº”ï¼ˆè¡¥å……ï¼‰ï¼šæ­å»ºäº‘ç«¯inflexdb

æˆ‘ä»¬å°†åˆ†å››æ­¥èµ°ï¼š

1.  **æ³¨å†Œ InfluxDB Cloud å¹¶åˆ›å»º Bucket (åœ¨æµè§ˆå™¨)**
2.  **è·å–äº‘ç«¯ Token å’Œ Org (åœ¨æµè§ˆå™¨)**
3.  **ä¿®æ”¹ `pyt/backend.py` ä»£ç  (åœ¨ VSCode)**
4.  **è¿è¡Œå’ŒéªŒè¯**

-----

### æ­¥éª¤ 1: æ³¨å†Œå’Œåˆ›å»º Bucket (åœ¨ InfluxDB Cloud ç½‘ç«™)

1.  **æ‰“å¼€ç½‘é¡µ**ï¼š
    æ‰“å¼€ã€Šå®éªŒæ­¥éª¤.pdfã€‹ä¸­æä¾›çš„äº‘ç«¯æœåŠ¡ç½‘é¡µï¼š`https://us-east-1-1.aws.cloud2.influxdata.com`ã€‚

2.  **æ³¨å†Œè´¦å·**ï¼š

      * ç‚¹å‡» "Sign Up" æˆ– "Get Started"ã€‚
      * å¡«å†™ä½ çš„é‚®ç®±ã€å¯†ç ã€å…¬å¸åï¼ˆéšä¾¿å¡«ï¼‰ç­‰ä¿¡æ¯å®Œæˆæ³¨å†Œã€‚
      * ç™»å½•åï¼Œå®ƒå¯èƒ½ä¼šè®©ä½ é€‰æ‹©ä¸€ä¸ªäº‘æœåŠ¡å•†ï¼ˆAWS, GCP, Azureï¼‰å’ŒåŒºåŸŸï¼ˆRegionï¼‰ï¼Œ**ä½ å¯ä»¥éšä¾¿é€‰ä¸€ä¸ªå…è´¹çš„**ï¼ˆæ¯”å¦‚ AWS çš„ us-east-1ï¼‰ã€‚

3.  **åˆ›å»º Bucket**ï¼š

      * ç™»å½•æˆåŠŸåï¼Œä½ ä¼šè¿›å…¥ InfluxDB Cloud çš„ä¸»ç•Œé¢ã€‚
      * åœ¨å·¦ä¾§èœå•æ ï¼Œæ‰¾åˆ°ä¸€ä¸ªåƒ â€œæ¡¶â€ ä¸€æ ·çš„å›¾æ ‡ï¼Œç‚¹å‡» â€œ**Load Data**â€ -\> â€œ**Buckets**â€ã€‚
      * ç‚¹å‡»å³ä¸Šè§’çš„ â€œ**+ Create Bucket**â€ã€‚
      * ç»™ä½ çš„äº‘ç«¯å­˜å‚¨æ¡¶èµ·ä¸€ä¸ªæ–°åå­—ï¼Œä¾‹å¦‚ï¼š`my_cloud_bucket`ã€‚ï¼ˆä¸è¦å’Œæœ¬åœ°çš„ `mqtt_bucket` ææ··äº†ï¼‰
      * ç‚¹å‡» "Create"ã€‚

-----

### æ­¥éª¤ 2: è·å–äº‘ç«¯ Token å’Œ Org (åœ¨ InfluxDB Cloud ç½‘ç«™)

ç°åœ¨ï¼Œä½ éœ€è¦ 3 ä¸ªå…³é”®ä¿¡æ¯æ‰èƒ½è®© Python è¿æ¥åˆ°äº‘ç«¯ã€‚**è¯·æŠŠè¿™ 3 ä¸ªä¿¡æ¯å¤åˆ¶åˆ°ä¸€ä¸ªè®°äº‹æœ¬é‡Œ**ï¼š

1.  **ä½ çš„ Token (API ä»¤ç‰Œ)**ï¼š

      * åœ¨å·¦ä¾§èœå•æ ï¼Œç‚¹å‡» â€œ**Load Data**â€ -\> â€œ**API Tokens**â€ã€‚
      * ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ã€ä»¥ä½ åå­—å‘½åçš„ Tokenï¼ˆä¾‹å¦‚ `Your_Name's Token`ï¼‰ã€‚
      * **ç‚¹å‡»è¿™ä¸ª Token çš„åå­—**ã€‚
      * ç‚¹å‡» â€œ**Copy to Clipboard**â€ï¼ˆå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼‰æŒ‰é’®ã€‚
      * **è¿™å°±æ˜¯ä½ çš„ `INFLUX_CLOUD_TOKEN`**ã€‚

2.  **ä½ çš„ Org (ç»„ç»‡åç§°)**ï¼š

      * ä½ çš„ç»„ç»‡åç§°é€šå¸¸æ˜¾ç¤ºåœ¨**å·¦ä¸Šè§’**ï¼Œåœ¨ä½ çš„é‚®ç®±åœ°å€ä¸‹é¢ã€‚
      * **è¿™å°±æ˜¯ä½ çš„ `INFLUX_CLOUD_ORG`**ã€‚

3.  **ä½ çš„ URL (äº‘ç«¯åœ°å€)**ï¼š

      * åœ¨å·¦ä¾§èœå•æ ï¼Œç‚¹å‡»æœ€ä¸‹æ–¹çš„â€œä¸ªäººâ€å›¾æ ‡ï¼Œç„¶åé€‰æ‹© â€œ**About**â€ã€‚
      * ä½ ä¼šçœ‹åˆ° â€œCloud URLâ€ï¼Œå®ƒå°±æ˜¯ `https://us-east-1-1.aws.cloud2.influxdata.com`ï¼ˆæˆ–è€…æ ¹æ®ä½ é€‰æ‹©çš„åŒºåŸŸè€Œå®šï¼‰ã€‚
      * **è¿™å°±æ˜¯ä½ çš„ `INFLUX_CLOUD_URL`**ã€‚

-----

### æ­¥éª¤ 3: ä¿®æ”¹ `pyt/backend.py` ä»£ç  (åœ¨ VSCode)

ç°åœ¨æˆ‘ä»¬æ¥ä¿®æ”¹ Python åç«¯ï¼Œè®©å®ƒ**åŒæ—¶**å‘**æœ¬åœ° InfluxDB** å’Œ**äº‘ç«¯ InfluxDB** å†™å…¥æ•°æ®ã€‚

è¯·**æ›¿æ¢** `pyt/backend.py` æ–‡ä»¶çš„**å…¨éƒ¨å†…å®¹**ä¸ºä»¥ä¸‹ä»£ç ï¼š

**æ–‡ä»¶è·¯å¾„ï¼š** `.../class2up/pyt/backend.py`

```python
from flask import Flask, request, jsonify
from flask_cors import CORS
from flask_mqtt import Mqtt
import json
import pymysql
import datetime
from influxdb_client import InfluxDBClient, Point, WritePrecision
from influxdb_client.client.write_api import SYNCHRONOUS
import requests
import atexit
import joblib
import numpy as np

# --- æ•°æ®åº“é…ç½® ---
# 1. MySQL é…ç½® (ä¿æŒä¸å˜)
MYSQL_HOST = 'localhost'
MYSQL_USER = 'root'
MYSQL_PASSWORD = 'xjtu2025'  # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨çš„MySQLå¯†ç ï¼ï¼ï¼
MYSQL_DB = 'mqtt_data'
MYSQL_PORT = 3306

# 2. InfluxDB (æœ¬åœ°) é…ç½® (ä¿æŒä¸å˜)
INFLUX_LOCAL_URL = "http://localhost:8086"
INFLUX_LOCAL_TOKEN = "YOUR_API_TOKEN_HERE"  # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨çš„æœ¬åœ° Tokenï¼ï¼ï¼
INFLUX_LOCAL_ORG = "my-org"                 # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨çš„æœ¬åœ°ç»„ç»‡ï¼ï¼ï¼
INFLUX_LOCAL_BUCKET = "mqtt_bucket"         # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨çš„æœ¬åœ°å­˜å‚¨æ¡¶ï¼ï¼ï¼

# 3. (æ–°å¢) InfluxDB (äº‘ç«¯) é…ç½®
# ï¼ï¼ï¼ è¯·ç”¨ä½ åœ¨ æ­¥éª¤ 2 ä¸­å¤åˆ¶çš„ä¿¡æ¯æ›¿æ¢è¿™äº›å ä½ç¬¦ ï¼ï¼ï¼
INFLUX_CLOUD_URL = "https://us-east-1-1.aws.cloud2.influxdata.com"
INFLUX_CLOUD_TOKEN = "YOUR_CLOUD_TOKEN_HERE" # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨çš„äº‘ç«¯ Tokenï¼ï¼ï¼
INFLUX_CLOUD_ORG = "YOUR_CLOUD_ORG_HERE"     # ï¼ï¼ï¼è¯·ä¿®æ”¹ä¸ºæ‚¨çš„äº‘ç«¯ Orgï¼ï¼ï¼
INFLUX_CLOUD_BUCKET = "my_cloud_bucket"      # (ä½ åˆšåˆšåˆ›å»ºçš„äº‘ç«¯ Bucket)

# --- (æ–°å¢) HDFS å¹³å°é…ç½® (å ä½ç¬¦) ---
HDFS_WEB_API_URL = "http://YOUR_HADOOP_HOST:9870/webhdfs/v1"
HDFS_TARGET_PATH = "/user/your_name/machine_data.csv"
HDFS_USER = "your_username"

# --- (æ–°å¢) ML æ¨¡å‹é…ç½® ---
MODEL_PATH = 'pyt/status_predictor.pkl'
DATA_WINDOW_SIZE = 50
model = None

# --- åˆå§‹åŒ–æ‰€æœ‰å®¢æˆ·ç«¯ ---
try:
    # (ä¿®æ”¹) åˆå§‹åŒ–æœ¬åœ° InfluxDB å®¢æˆ·ç«¯
    influx_client_local = InfluxDBClient(url=INFLUX_LOCAL_URL, token=INFLUX_LOCAL_TOKEN, org=INFLUX_LOCAL_ORG)
    write_api_local = influx_client_local.write_api(write_options=SYNCHRONOUS)
    print("InfluxDB æœ¬åœ°å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸã€‚")
except Exception as e:
    print(f"InfluxDB æœ¬åœ°å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥: {e}")

try:
    # (æ–°å¢) åˆå§‹åŒ–äº‘ç«¯ InfluxDB å®¢æˆ·ç«¯
    influx_client_cloud = InfluxDBClient(url=INFLUX_CLOUD_URL, token=INFLUX_CLOUD_TOKEN, org=INFLUX_CLOUD_ORG)
    write_api_cloud = influx_client_cloud.write_api(write_options=SYNCHRONOUS)
    print("InfluxDB äº‘ç«¯å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸã€‚")
except Exception as e:
    print(f"InfluxDB äº‘ç«¯å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥: {e}")

# (æ–°å¢) åŠ è½½ ML æ¨¡å‹
try:
    model = joblib.load(MODEL_PATH)
    print(f"æœºå™¨å­¦ä¹ æ¨¡å‹ {MODEL_PATH} åŠ è½½æˆåŠŸã€‚")
except Exception as e:
    print(f"æ¨¡å‹åŠ è½½å¤±è´¥: {e} (è¯·å…ˆè¿è¡Œ _create_dummy_model.py)")

# HDFS æœ¬åœ°ä¸´æ—¶æ–‡ä»¶
local_temp_file_path = "hdfs_temp_data.csv"
local_file = None
try:
    local_file = open(local_temp_file_path, "a", encoding="utf-8")
    if local_file.tell() == 0:
        local_file.write("timestamp,data_id,value\n")
    print(f"æ‰“å¼€æœ¬åœ°ä¸´æ—¶æ–‡ä»¶ {local_temp_file_path} æˆåŠŸã€‚")
except Exception as e:
    print(f"æ‰“å¼€æœ¬åœ°ä¸´æ—¶æ–‡ä»¶å¤±è´¥: {e}")

@atexit.register
def upload_to_hdfs_on_exit():
    # ... (æ­¤å‡½æ•°ä¿æŒä¸å˜) ...
    global local_file
    if local_file:
        local_file.close()
        print(f"ç¨‹åºé€€å‡ºï¼Œæ­£åœ¨å°† {local_temp_file_path} ä¸Šä¼ åˆ° HDFS...")
        try:
            create_url = f"{HDFS_WEB_API_URL}{HDFS_TARGET_PATH}?op=CREATE&overwrite=true&user.name={HDFS_USER}"
            r_create = requests.put(create_url, allow_redirects=False)
            if r_create.status_code == 307:
                data_node_url = r_create.headers['Location']
                with open(local_temp_file_path, "rb") as f:
                    r_upload = requests.put(data_node_url, data=f)
                    if r_upload.status_code == 201:
                        print(f"HDFS æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: {HDFS_TARGET_PATH}")
                    else:
                        print(f"HDFS æ–‡ä»¶ä¸Šä¼ å¤±è´¥: {r_upload.status_code} - {r_upload.text}")
            else:
                 print(f"HDFS 'CREATE' è¯·æ±‚å¤±è´¥: {r_create.status_code} - {r_create.text}")
        except Exception as e:
            print(f"HDFS ä¸Šä¼ æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯: {e}")

# --- Flask å’Œ MQTT åˆå§‹åŒ– (ä¿æŒä¸å˜) ---
app = Flask(__name__)
CORS(app)
app.config['MQTT_BROKER_URL'] = '127.0.0.1'
app.config['MQTT_BROKER_PORT'] = 1883
app.config['MQTT_CLIENT_ID'] = 'flask_mqtt_client'
mqtt = Mqtt(app)

# --- æ•°æ®å­˜å‚¨ (ä¿æŒä¸å˜) ---
latest_data_store = {}
data_window_store = {}

# --- æ•°æ®åº“å†™å…¥å‡½æ•° ---
def save_to_mysql(data_id, value, time_str):
    # ... (æ­¤å‡½æ•°ä¿æŒä¸å˜) ...
    conn = None
    cur = None
    try:
        conn = pymysql.connect(host=MYSQL_HOST, user=MYSQL_USER, password=MYSQL_PASSWORD, database=MYSQL_DB, port=MYSQL_PORT, charset='utf8')
        cur = conn.cursor()
        sql = "INSERT INTO mac_data (data_id, payload, time) VALUES (%s, %s, %s)"
        cur.execute(sql, (data_id, str(value), time_str))
        conn.commit()
        print(f"MySQL å†™å…¥æˆåŠŸ: ID={data_id}, Value={value}")
    except Exception as e:
        print(f"MySQL å†™å…¥å¤±è´¥: {e}")
    finally:
        if cur: cur.close()
        if conn: conn.close()

def save_to_influxdb_local(data_id, value, time_obj): # (å‡½æ•°åä¿®æ”¹)
    try:
        value_float = float(value)
        p = Point("machine_data").tag("device_id", "STRESS_TEST_00000").tag("data_id", data_id).field("value", value_float).time(time_obj, WritePrecision.NS)
        write_api_local.write(bucket=INFLUX_LOCAL_BUCKET, org=INFLUX_LOCAL_ORG, record=p) # (å˜é‡åä¿®æ”¹)
        print(f"InfluxDB æœ¬åœ° å†™å…¥æˆåŠŸ: ID={data_id}, Value={value_float}")
    except Exception as e:
        print(f"InfluxDB æœ¬åœ° å†™å…¥å¤±è´¥: {e}")

# (æ–°å¢) å†™å…¥ InfluxDB äº‘ç«¯
def save_to_influxdb_cloud(data_id, value, time_obj):
    try:
        value_float = float(value)
        p = Point("machine_data_cloud") \
            .tag("device_id", "STRESS_TEST_00000") \
            .tag("data_id", data_id) \
            .field("value", value_float) \
            .time(time_obj, WritePrecision.NS)
        
        # ä½¿ç”¨äº‘ç«¯é…ç½®çš„ API å†™å…¥
        write_api_cloud.write(bucket=INFLUX_CLOUD_BUCKET, org=INFLUX_CLOUD_ORG, record=p)
        print(f"InfluxDB äº‘ç«¯ å†™å…¥æˆåŠŸ: ID={data_id}, Value={value_float}")
    except Exception as e:
        print(f"InfluxDB äº‘ç«¯ å†™å…¥å¤±è´¥: {e}")

def save_to_distributed_platform(data_id, value, time_obj):
    # ... (æ­¤å‡½æ•°ä¿æŒä¸å˜) ...
    global local_file
    if local_file:
        try:
            time_iso = time_obj.isoformat()
            line = f"{time_iso},{data_id},{value}\n"
            local_file.write(line)
            local_file.flush()
        except Exception as e:
            print(f"æœ¬åœ°ä¸´æ—¶æ–‡ä»¶å†™å…¥å¤±è´¥: {e}")

# --- MQTT å›è°ƒ (æ›´æ–°) ---
@mqtt.on_connect()
def handle_connect(client, userdata, flags, rc):
    # ... (æ­¤å‡½æ•°ä¿æŒä¸å˜) ...
    if rc == 0:
        print("MQTT è¿æ¥æˆåŠŸ (rc=0)")
        response_topic = "Query/Response/STRESS_TEST_00000"
        mqtt.subscribe(response_topic)
        print(f"å·²è‡ªåŠ¨è®¢é˜…ä¸»é¢˜: {response_topic}")
    else:
        print(f"MQTT è¿æ¥å¤±è´¥ï¼Œè¿”å›ç : {rc}")

@mqtt.on_message()
def handle_message(client, userdata, message):
    # (æ›´æ–°)
    try:
        payload_str = message.payload.decode()
        data = json.loads(payload_str)
        
        time_now_utc = datetime.datetime.utcnow()
        time_now_local_str = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")

        if 'values' in data and isinstance(data['values'], list):
            for item in data['values']:
                if 'id' in item and 'values' in item:
                    data_id = item['id']
                    value = item['values'][0]
                    
                    # 1. æš‚å­˜ (ä¾› Echarts)
                    latest_data_store[data_id] = value

                    # 2. å­˜å‚¨æ•°æ®çª—å£ (ä¾› ML)
                    if data_id not in data_window_store:
                        data_window_store[data_id] = []
                    data_window_store[data_id].append(float(value))
                    if len(data_window_store[data_id]) > DATA_WINDOW_SIZE:
                        data_window_store[data_id].pop(0)

                    # 3. å†™å…¥ MySQL
                    save_to_mysql(data_id, value, time_now_local_str)
                    
                    # 4. å†™å…¥ InfluxDB (æœ¬åœ°)
                    save_to_influxdb_local(data_id, value, time_now_utc)
                    
                    # 5. (æ–°å¢) å†™å…¥ InfluxDB (äº‘ç«¯)
                    save_to_influxdb_cloud(data_id, value, time_now_utc)
                    
                    # 6. å†™å…¥ HDFS ç¼“å­˜
                    save_to_distributed_platform(data_id, value, time_now_utc)
            
    except Exception as e:
        print(f"å¤„ç†æ¶ˆæ¯å¤±è´¥: {e}")

# --- Flask API è·¯ç”± (ä¿æŒä¸å˜) ---
@app.route('/connect/', methods=['POST', 'GET'])
def make_connect():
    # ... (æ­¤å‡½æ•°ä¿æŒä¸å˜) ...
    try:
        data_connect = request.get_json()['data']
        app.config['MQTT_BROKER_URL'] = data_connect['host']
        app.config['MQTT_BROKER_PORT'] = data_connect['port']
        app.config['MQTT_CLIENT_ID'] = data_connect['clientid']
        if mqtt.client.is_connected():
            mqtt.client.disconnect()
        mqtt.client.username_pw_set(None, None)
        mqtt.client._client_id = data_connect['clientid'].encode()
        mqtt.client.reinitialise()
        mqtt.client.connect(data_connect['host'], data_connect['port'])
        return jsonify({'rc_status': 'success'})
    except Exception as e:
        return jsonify({'rc_status': str(e)})

@app.route('/publish/', methods=['POST'])
def do_publish():
    # ... (æ­¤å‡½æ•°ä¿æŒä¸å˜) ...
    try:
        data = request.get_json()
        topic = data.get('topic')
        payload = data.get('payload', "{}")
        mqtt.publish(topic, payload)
        return jsonify({'status': 'published', 'topic': topic})
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)}), 500

@app.route('/get_data/', methods=['POST'])
def get_data():
    # ... (æ­¤å‡½æ•°ä¿æŒä¸å˜) ...
    global latest_data_store 
    try:
        data = request.get_json()
        data_id = data.get('id')
        value = latest_data_store.get(data_id) 
        if value is not None:
            return jsonify({'status': 'ok', 'id': data_id, 'value': value})
        else:
            return jsonify({'status': 'not_found', 'id': data_id, 'value': None})
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)}), 500

@app.route('/predict/', methods=['POST'])
def predict_status():
    # ... (æ­¤å‡½æ•°ä¿æŒä¸å˜) ...
    global model
    if model is None:
        return jsonify({'status': 'error', 'message': 'æ¨¡å‹æœªåŠ è½½'}), 500
    try:
        data = request.get_json()
        data_id = data.get('id')
        window_data = data_window_store.get(data_id)
        if not window_data or len(window_data) < DATA_WINDOW_SIZE:
            return jsonify({'status': 'wait', 'message': f'æ•°æ®é‡‡é›†ä¸­ï¼Œå½“å‰ {len(window_data) if window_data else 0}/{DATA_WINDOW_SIZE} ç‚¹ï¼Œè¯·ç¨å€™...'})
        features_vector = np.array(window_data).reshape(1, -1)
        prediction_code = model.predict(features_vector)
        status_map = {0: 'è®¾å¤‡çŠ¶æ€æ­£å¸¸', 1: 'è®¾å¤‡æ•…éšœé¢„è­¦'}
        prediction_text = status_map.get(prediction_code[0], 'æœªçŸ¥çŠ¶æ€')
        return jsonify({'status': 'ok', 'prediction': prediction_text})
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)}), 500

# å¯åŠ¨ Flask æœåŠ¡
if __name__ == '__main__':
    app.run(debug=True, host='127.0.0.1', port=5000)
```

-----

### æ­¥éª¤ 4: è¿è¡Œå’ŒéªŒè¯

1. **ä¿å­˜ä»£ç **ï¼š

     * ç¡®ä¿ä½ æŠŠä» InfluxDB Cloud ç½‘ç«™å¤åˆ¶çš„ `URL`, `TOKEN`, å’Œ `ORG` **æ­£ç¡®åœ°**ç²˜è´´åˆ°äº† `backend.py` çš„ `INFLUX_CLOUD_...` å˜é‡é‡Œã€‚

2. **é‡å¯åç«¯**ï¼š

     * **åœæ­¢**ä½ çš„ Python åç«¯ï¼ˆç»ˆç«¯ 5ï¼‰(æŒ‰ `Ctrl+C`)ã€‚

     * **é‡æ–°è¿è¡Œ** `python pyt/backend.py`ã€‚

     * **ï¼ˆé‡è¦ï¼ï¼‰** æ£€æŸ¥ç»ˆç«¯è¾“å‡ºï¼Œä½ ç°åœ¨åº”è¯¥çœ‹åˆ°**ä¸¤ä¸ª**æˆåŠŸä¿¡æ¯ï¼š

       ```
       InfluxDB æœ¬åœ°å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸã€‚
       InfluxDB äº‘ç«¯å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸã€‚
       ```

     * å¦‚æœäº‘ç«¯åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·å›å»**ä»”ç»†æ£€æŸ¥**ä½ çš„ URL, Token å’Œ Org æ˜¯ä¸æ˜¯å¤åˆ¶é”™äº†ã€‚

3. **éªŒè¯å†™å…¥**ï¼š

     * è®©æ‰€æœ‰æœåŠ¡ï¼ˆEMQX, StressTest, Influxd, VUE, Pythonï¼‰è¿è¡Œä¸€ä¸¤åˆ†é’Ÿã€‚

     * ä½ çš„ Python ç»ˆç«¯ï¼ˆç»ˆç«¯ 5ï¼‰ç°åœ¨åº”è¯¥**åŒæ—¶**æ‰“å°ï¼š

       ```
       InfluxDB æœ¬åœ° å†™å…¥æˆåŠŸ: ...
       InfluxDB äº‘ç«¯ å†™å…¥æˆåŠŸ: ...
       ```

4. **åœ¨äº‘ç«¯æŸ¥çœ‹æ•°æ®**ï¼š

     * å›åˆ°ä½ çš„ **InfluxDB Cloud æµè§ˆå™¨çª—å£**ã€‚
     * ç‚¹å‡»å·¦ä¾§èœå•çš„ â€œ**Data Explorer**â€ (æˆ– "Explore")ã€‚
     * åœ¨æŸ¥è¯¢æ„å»ºå™¨ (Query Builder) ä¸­ï¼š
       * **FROM:** é€‰æ‹©ä½ çš„äº‘ç«¯å­˜å‚¨æ¡¶ `my_cloud_bucket`ã€‚
       * **Filter (Measurement):** é€‰æ‹© `machine_data_cloud`ã€‚
       * **Filter (Field):** é€‰æ‹© `value`ã€‚
     * ç‚¹å‡» â€œ**Submit**â€ã€‚

**é¢„æœŸç»“æœï¼š**
ä½ ä¼šåœ¨ **InfluxDB Cloud ç½‘ç«™**ä¸Šçœ‹åˆ°ä¸€ä¸ª**ä¸€æ¨¡ä¸€æ ·**çš„å®æ—¶æ•°æ®å›¾è¡¨ï¼Œè¯æ˜ä½ æœ¬åœ°çš„æ•°æ®å·²ç»æˆåŠŸåŒæ­¥åˆ°äº‘ç«¯äº†ï¼

**ä»»åŠ¡äº”å®Œæˆ**ã€‚æˆ‘ä»¬ç°åœ¨å·²ç»å…·å¤‡äº†æ•°æ®é‡‡é›†ã€å‰åç«¯é€šä¿¡ã€å®æ—¶å¯è§†åŒ–å’ŒåŒæ•°æ®åº“å­˜å‚¨çš„èƒ½åŠ›ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›è¡Œ**ä»»åŠ¡å…­ï¼šå¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨**ï¼Œè¿™éœ€è¦æˆ‘ä»¬å°† MySQL ä¸­çš„æ•°æ®å¯¹æ¥åˆ°å·¥ä¸šå¤§æ•°æ®å¹³å°ï¼ˆHadoopï¼‰ã€‚

---

åœ¨æ­¤ä¹‹å‰ï¼Œå¯¹ä»»åŠ¡ä¸€åˆ°ä»»åŠ¡äº”é‡åˆ°çš„é—®é¢˜è¿›è¡Œä¸€ä¸ªå°çš„å›é¡¾ä¸æ€»ç»“ï¼š

## ä»»åŠ¡ä¸€åˆ°å…­é‡åˆ°ä¸»è¦é—®é¢˜ï¼š

---

### é˜¶æ®µä¸€ï¼šVUE å‰ç«¯å¯åŠ¨ä¸é…ç½®ï¼ˆâ€œæˆ‘çš„ç½‘é¡µè·‘ä¸èµ·æ¥â€ï¼‰

è¿™æ˜¯æˆ‘ä»¬æœ€æ—©é‡åˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å½“æ—¶çš„ç›®æ ‡æ˜¯å…ˆæŠŠ VUE æ¡†æ¶è·‘èµ·æ¥ã€‚

**é—®é¢˜ 1ï¼š`'vue-cli-service' ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤...`**

* **ä½ é‡åˆ°çš„ç°è±¡ï¼š** åœ¨ç»ˆç«¯é‡Œè¿è¡Œ `npm run serve`ï¼Œç›´æ¥æŠ¥é”™ã€‚
* **èƒŒåçš„åŸå› ï¼š**
  1.  ä½ ç”¨äº† `npm`ï¼Œä½†é¡¹ç›®æ–‡ä»¶é‡Œæœ‰ `yarn.lock`ï¼Œè¯´æ˜å®ƒæ˜¯ä¸ª `yarn` é¡¹ç›®ã€‚
  2.  ä½ æ²¡æœ‰è¿è¡Œ `yarn install`ï¼Œæ‰€ä»¥ `node_modules` æ–‡ä»¶å¤¹æ˜¯ç©ºçš„ï¼Œç³»ç»Ÿæ ¹æœ¬æ‰¾ä¸åˆ° `vue-cli-service` è¿™ä¸ªç¨‹åºã€‚
* **è§£å†³æ–¹æ¡ˆï¼š** ä¸¥æ ¼æŒ‰ç…§ `README.md` æ–‡ä»¶ï¼Œå…ˆè¿è¡Œ `yarn install` å®‰è£…ä¾èµ–ï¼Œå†è¿è¡Œ `yarn serve` å¯åŠ¨ã€‚

**é—®é¢˜ 2ï¼š`Module not found: Error: Can't resolve 'element-ui', 'vue-router'` ç­‰...**

* **ä½ é‡åˆ°çš„ç°è±¡ï¼š** `yarn serve` è¿è¡Œæ—¶ï¼Œç¼–è¯‘å¤±è´¥ï¼ŒæŠ¥äº†ä¸€å¤§å †â€œæ¨¡å—æœªæ‰¾åˆ°â€çš„é”™è¯¯ã€‚
* **èƒŒåçš„åŸå› ï¼š** æˆ‘ä»¬åœ¨â€œä»»åŠ¡ä¸€â€é‡Œç»™ `main.js` å’Œ `router.js` æ·»åŠ äº† `import ElementUI` å’Œ `import VueRouter`ï¼Œä½†æ˜¯æˆ‘ä»¬**åª `import`ï¼ˆå¼•ç”¨ï¼‰äº†**ï¼Œå´**æ²¡æœ‰çœŸæ­£æŠŠè¿™äº›åº“â€œå®‰è£…â€åˆ°é¡¹ç›®é‡Œ**ã€‚
* **è§£å†³æ–¹æ¡ˆï¼š** è¿è¡Œ `yarn add vue-router@3 element-ui axios echarts`ï¼ŒæŠŠæˆ‘ä»¬ä»£ç ä¸­ç”¨åˆ°çš„æ‰€æœ‰æ–°ä¾èµ–ä¸€æ¬¡æ€§å…¨è£…ä¸Šã€‚

**é—®é¢˜ 3ï¼šæµè§ˆå™¨æ˜¾ç¤º `Proxy error: ... ECONNREFUSED`**

* **ä½ é‡åˆ°çš„ç°è±¡ï¼š** VUE é¡µé¢èƒ½æ‰“å¼€ï¼Œä½†F12æ§åˆ¶å°ï¼ˆæˆ–ç»ˆç«¯ï¼‰æŠ¥â€œä»£ç†é”™è¯¯ï¼Œè¿æ¥è¢«æ‹’ç»â€ã€‚
* **èƒŒåçš„åŸå› ï¼š** `ECONNREFUSED` = è¿æ¥è¢«æ‹’ç»ã€‚ä½ çš„ VUE å‰ç«¯ï¼ˆ`localhost:8080`ï¼‰æ­£åœ¨å°è¯•è®¿é—® `vue.config.js` é‡Œé…ç½®çš„åç«¯åœ°å€ï¼ˆ`http://127.0.0.1:5000`ï¼‰ï¼Œä½†é‚£ä¸ªåœ°å€ä¸Š**ä»€ä¹ˆæœåŠ¡éƒ½æ²¡æœ‰**ã€‚
* **è§£å†³æ–¹æ¡ˆï¼š** å¯åŠ¨æˆ‘ä»¬çš„ **Python åç«¯æœåŠ¡**ã€‚è¿™è¯æ˜äº†å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå¿…é¡»**è‡³å°‘**è¿è¡Œä¸¤ä¸ªç»ˆç«¯ï¼šä¸€ä¸ª `yarn serve` (å‰ç«¯)ï¼Œä¸€ä¸ª `python pyt/backend.py` (åç«¯)ã€‚

---

### é˜¶æ®µäºŒï¼šPython åç«¯ä¸ç¯å¢ƒé…ç½®ï¼ˆâ€œæˆ‘çš„åç«¯ä¹Ÿè·‘ä¸èµ·æ¥â€ï¼‰

**é—®é¢˜ 4ï¼š`ModuleNotFoundError: No module named 'influxdb_client'`**

* **ä½ é‡åˆ°çš„ç°è±¡ï¼š** `python pyt/backend.py` å¯åŠ¨å¤±è´¥ï¼ŒæŠ¥â€œæ¨¡å—æœªæ‰¾åˆ°â€ã€‚
* **èƒŒåçš„åŸå› ï¼š** å’Œ VUE çš„é—®é¢˜ä¸€æ ·ï¼Œæˆ‘ä»¬ `import influxdb_client` äº†ï¼Œä½†ä½ çš„ Python ç¯å¢ƒé‡Œæ²¡æœ‰å®‰è£…å®ƒã€‚
* **è§£å†³æ–¹æ¡ˆï¼š** è¿è¡Œ `pip install influxdb-client`ï¼ˆä»¥åŠ Flask, pymysql ç­‰æ‰€æœ‰æˆ‘ä»¬éœ€è¦çš„åº“ï¼‰ã€‚

**é—®é¢˜ 5ï¼šMySQL æŠ¥é”™ `1045 - Access denied for user 'root'`**

* **ä½ é‡åˆ°çš„ç°è±¡ï¼š** ä½ ç”¨ Navicat æµ‹è¯•è¿æ¥ MySQL å¤±è´¥ã€‚
* **èƒŒåçš„åŸå› ï¼š** ä½ åœ¨ Navicat é‡Œå¡«çš„å¯†ç ï¼Œå’Œä½ ç”µè„‘ä¸Šå®‰è£… MySQL æ—¶è®¾ç½®çš„ `root` å¯†ç **ä¸ä¸€è‡´**ã€‚
* **è§£å†³æ–¹æ¡ˆï¼š** åœ¨ `pyt/backend.py` å’Œ Navicat ä¸­ï¼Œéƒ½ç»Ÿä¸€æ”¹æˆä½ **æ­£ç¡®çš„** MySQL `root` å¯†ç ã€‚

**é—®é¢˜ 6ï¼š`'influxd' ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤...`**

* **ä½ é‡åˆ°çš„ç°è±¡ï¼š** å¯åŠ¨ InfluxDB æ•°æ®åº“æœåŠ¡æ—¶ï¼Œç³»ç»Ÿæ‰¾ä¸åˆ° `influxd`ã€‚
* **èƒŒåçš„åŸå› ï¼š**
  1.  ã€Šå®éªŒæ­¥éª¤.pdfã€‹é‡Œçš„è·¯å¾„ `E:\MQTT-test` æ˜¯è€å¸ˆç”µè„‘ä¸Šçš„ï¼Œä½ ç”µè„‘ä¸Šæ²¡æœ‰ã€‚
  2.  `influxd` æ˜¯ä¸€ä¸ª**ç‹¬ç«‹çš„æœåŠ¡ç¨‹åº**ï¼Œå’Œæˆ‘ä»¬ç”¨ `pip` è£…çš„ `influxdb-client`ï¼ˆåº“ï¼‰æ˜¯ä¸¤å›äº‹ã€‚
  3.  ä½ åœ¨ `cmd` é‡Œä» C ç›˜åˆ‡æ¢åˆ° D ç›˜æ—¶ï¼Œå‘½ä»¤æ²¡ç”¨å¯¹ï¼ˆä½ ç”¨äº† `cd D:\...`ï¼Œä½†æ­£ç¡®å§¿åŠ¿æ˜¯å…ˆè¾“ `D:` å† `cd`ï¼‰ã€‚
* **è§£å†³æ–¹æ¡ˆï¼š**
  1.  ä» InfluxDB å®˜ç½‘ä¸‹è½½ `.zip` åŒ…å¹¶è§£å‹ï¼ˆæ¯”å¦‚åˆ° `D:\code9\class2down\influxd`ï¼‰ã€‚
  2.  åœ¨ `cmd` ä¸­å…ˆç”¨ `D:` åˆ‡æ¢ç›˜ç¬¦ï¼Œå†ç”¨ `cd D:\code9\class2down\influxd` è¿›å…¥ç›®å½•ã€‚
  3.  è¿è¡Œ `influxd` å¯åŠ¨æœåŠ¡ã€‚

---

### é˜¶æ®µä¸‰ï¼šè”è°ƒä¸â€œçµå¼‚äº‹ä»¶â€ï¼ˆâ€œä¸ºä»€ä¹ˆå®ƒå°±æ˜¯ä¸å·¥ä½œï¼Ÿï¼â€ï¼‰

è¿™æ˜¯æœ€â€œé˜´â€çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åˆšåˆšæ‰è§£å†³çš„ï¼ä½ æ‰€æœ‰çš„æœåŠ¡ï¼ˆ5ä¸ªç»ˆç«¯ï¼‰éƒ½è·‘èµ·æ¥äº†ï¼Œä½† VUE é¡µé¢å°±æ˜¯æ²¡æ•°æ® ``ã€‚

**é—®é¢˜ 7ï¼šâ€œæ— é™é‡å¯â€ Bug (æ¥è‡ª `image_2b1be4.png`)**

* **ä½ é‡åˆ°çš„ç°è±¡ï¼š** Python åç«¯ï¼ˆç»ˆç«¯5ï¼‰ä¸åœåœ°é‡å¤æ‰“å° `MQTT è¿æ¥æˆåŠŸ` ``ã€‚
* **èƒŒåçš„åŸå› ï¼š** æˆ‘ä»¬åœ¨ `pyt/backend.py` çš„æœ€åä¸€è¡Œç”¨äº† `app.run(debug=True)`ã€‚
  * `debug=True` ä¼šâ€œç›‘è§†â€ä½ é¡¹ç›®é‡Œçš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸€æ”¹åŠ¨ï¼Œå®ƒå°±**è‡ªåŠ¨é‡å¯**æœåŠ¡ã€‚
  * æˆ‘ä»¬çš„ä»£ç **æ°å¥½**ä¼šå¾€é¡¹ç›®é‡Œçš„ `pyt/hdfs_temp_data.csv` æ–‡ä»¶**å†™æ•°æ®**ã€‚
  * è¿™å°±å¯¼è‡´ï¼šåç«¯æ”¶åˆ°æ•°æ® -> å†™å…¥æ–‡ä»¶ -> ç›‘è§†å™¨å‘ç°æ–‡ä»¶è¢«æ”¹ -> **ç«‹åˆ»é‡å¯** -> é‡å¯åæ‰“å° `MQTT è¿æ¥æˆåŠŸ` `` -> æ”¶åˆ°ä¸‹ä¸€æ¡æ•°æ®... å¦‚æ­¤å¾ªç¯ã€‚
* **è§£å†³æ–¹æ¡ˆï¼š** ä¿®æ”¹ `pyt/backend.py` çš„æœ€åä¸€è¡Œï¼Œæ”¹æˆ `app.run(debug=True, use_reloader=False)`ï¼Œ**å…³æ‰**è¿™ä¸ªè‡ªåŠ¨é‡å¯åŠŸèƒ½ã€‚

**é—®é¢˜ 8ï¼šâ€œå›¾è¡¨æ²¡çº¿â€ Bug (æ¥è‡ª `image_2b90d9.png`)**

* **ä½ é‡åˆ°çš„ç°è±¡ï¼š** VUE é¡µé¢å›¾è¡¨æ˜¯ç©ºçš„ ``ï¼ŒF12 æ§åˆ¶å°æ˜¾ç¤º `æ•°æ®ID ... å°šæœªæ”¶åˆ°` ``ã€‚
* **èƒŒåçš„åŸå› ï¼ˆè¿™ä¸ª Bug æœ‰ä¸¤ä¸ªâ€œå…ƒå‡¶â€ï¼‰ï¼š**
  1.  **Python ç«¯çš„å…ƒå‡¶**ï¼š`debug=True` å¯¼è‡´åç«¯æ— é™é‡å¯ï¼ˆé—®é¢˜7ï¼‰ï¼Œ`latest_data_store` å˜é‡åˆšå­˜ä¸Šæ•°æ®ï¼ˆæ¯”å¦‚ `10.9526`ï¼‰å°±è¢«**æ¸…ç©º**äº†ã€‚VUE æ¥å–æ•°æ®æ—¶ï¼Œåº“é‡Œæ°¸è¿œæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥åç«¯è¿”å› `not_found`ï¼ˆâ€œå°šæœªæ”¶åˆ°â€ï¼‰ã€‚
  2.  **VUE ç«¯çš„å…ƒå‡¶**ï¼šï¼ˆå³ä½¿åç«¯å¥½äº†ï¼‰`ShowData.vue` é‡Œçš„ Echarts `setOption` å‡½æ•°**å¿˜è®°**åŠ  `type: 'line'` äº†ã€‚Echarts æ‹¿åˆ°æ•°æ®ä½†ä¸çŸ¥é“è¯¥ç”»ä»€ä¹ˆå›¾ï¼Œæ‰€ä»¥ä¸ç”»ã€‚
* **è§£å†³æ–¹æ¡ˆï¼š**
  1.  è§£å†³â€œæ— é™é‡å¯â€ Bugï¼ˆé—®é¢˜7ï¼‰ã€‚
  2.  åœ¨ `ShowData.vue` é‡Œçš„ `setOption` ä¸­**å¿…é¡»**åŠ ä¸Š `type: 'line'` å’Œ `smooth: true`ã€‚

**é—®é¢˜ 9ï¼šInfluxDB æ•°æ®åº“æ²¡æœ‰æ•°æ® (æ¥è‡ª `image_2b8cfc.png` å’Œ `image_2b909d.png`)**

* **ä½ é‡åˆ°çš„ç°è±¡ï¼š** æœ¬åœ°å’Œäº‘ç«¯çš„ InfluxDB éƒ½æ˜¯ `No Results` ``ï¼Œä½†åç«¯æ—¥å¿—å´è¯´ `InfluxDB å†™å…¥æˆåŠŸ`ã€‚
* **èƒŒåçš„åŸå› ï¼ˆè¿™ä¸ª Bug ä¹Ÿæœ‰ä¸¤ä¸ªâ€œå…ƒå‡¶â€ï¼‰ï¼š**
  1.  **æ— é™é‡å¯çš„å…ƒå‡¶**ï¼ˆé—®é¢˜7ï¼‰ï¼šåç«¯æ—¥å¿—æ‰“å° `å†™å…¥æˆåŠŸ` åªæ˜¯ä»£è¡¨å®ƒ**è°ƒç”¨äº†**å†™å…¥å‡½æ•°ï¼Œä½†è¿˜æ²¡ç­‰æ•°æ®åŒ…çœŸæ­£é€šè¿‡ç½‘ç»œå‘åˆ°æ•°æ®åº“ï¼ŒæœåŠ¡å°±è¢«**é‡å¯**äº†ï¼Œæ‰€ä»¥æ•°æ®åº“å•¥ä¹Ÿæ²¡æ”¶åˆ°ã€‚
  2.  **Token æ ¼å¼çš„å…ƒå‡¶**ï¼šä½  `backend.py` é‡Œçš„**äº‘ç«¯ Token** å¤šäº† `INFLUXDB_TOKEN=` å­—æ ·ï¼Œå¯¼è‡´äº‘ç«¯è¿æ¥è®¤è¯å¤±è´¥ã€‚
* **è§£å†³æ–¹æ¡ˆï¼š**
  1.  è§£å†³â€œæ— é™é‡å¯â€ Bugï¼ˆé—®é¢˜7ï¼‰ã€‚
  2.  **æ¸…ç† Token**ï¼ŒæŠŠ `INFLUX_CLOUD_TOKEN = "INFLUXDB_TOKEN=zsOj..."` æ”¹æˆ `INFLUX_CLOUD_TOKEN = "zsOj..."`ã€‚
